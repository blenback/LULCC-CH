@charset = UTF-8
@date = 2023-Jul-20 18:14:37
@version = 7.2.0.20221230
@submodel.import = CreateCubeOfProbabilityMaps { { \"transitionMatrix\" : Table, \"inputFolder\" : Folder } { } { \"probabilityMapsRasterCube\" : Map } }; AllocateTransitions { { \"lanscape\" : CategoricalMap, \"probabilities\" : Map, \"transitionMatrix\" : TransitionMatrix, \"percentOfTransitionsByExpansion\" : PercentMatrix, \"patchExpansionParameters\" : TransitionFunctionParameterMatrix, \"patchGenerationParameters\" : TransitionFunctionParameterMatrix } { \"printTransitionInfo\" : BooleanValue } { \"resultingLanscape\" : CategoricalMap } }; CalcSimilarityOfDifferences { { \"initialMap\" : CategoricalMap, \"observedMap\" : CategoricalMap, \"simulatedMap\" : CategoricalMap } { \"useExponentialDecay\" : BooleanValue, \"windowSize\" : PositiveIntegerValue, \"printSimilarities\" : BooleanValue, \"exponentialDecayDivisor\" : RealValue } { \"similarityMap\" : Map, \"similarity\" : RealValue } }
Script {{
    @collapsed = no
    @alias = Simulation control
    _ := Group .none {{
        @alias = Specify control table file path: Table consisting of columns specifying the simulations to be performed (e.g. scenarios, length, versions etc.)
        specifyControlTableFilePathTableConsistingOfColumnsSpecifyingTheSimulationsToBePerformedEGScenariosLengthVersionsEtc := String $"(=====TABLE_PATH=====)";

        @collapsed = no
        @alias = Subset control table to only simulations yet to be completed (i.e. modelled)
        subsetControlTableToOnlySimulationsYetToBeCompletedIEModelled := CalculateRExpression "IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMgRGluYW1pY2Ffc3Vic2V0X2NvbnRyb2xfdGFibGU6IFN1YnNldCB0aGUgY29udHJvbCB0YWJsZSB0byByZW1vdmUgc2ltdWxhdGlvbnMKIyMgdGhhdCBoYXZlIGFscmVhZHkgYmVlbiBjb21wbGV0ZWQKIyMgRGF0ZTogMDEtMTAtMjAyMgojIyBBdXRob3I6IEJlbiBCbGFjawojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKI3JlY2VpdmUgY29udHJvbCB0YWJsZSAKQ29udHJvbF90YWJsZSA8LSByZWFkLmNzdihzMSkKCiNzdWJzZXQgdG8gbm9uLWNvbXBsZXRlZCBzaW11bGF0aW9ucwpDb250cm9sX3RhYmxlIDwtIENvbnRyb2xfdGFibGVbQ29udHJvbF90YWJsZSRDb21wbGV0ZWQuc3RyaW5nID09ICJOIixdCgojU2VuZCBiYWNrIHN1YnNldHRlZCB0YWJsZQpvdXRwdXRUYWJsZSgiUmVtYWluaW5nX3NpbXVsYXRpb25zIiAsQ29udHJvbF90YWJsZSk=" .no {{
            NumberString specifyControlTableFilePathTableConsistingOfColumnsSpecifyingTheSimulationsToBePerformedEGScenariosLengthVersionsEtc 1;
        }};

        specifyWorkingDirectoryFromR := String $"(=====WORK_DIR=====)";

        @viewer.table = yes
        subsettedControlTable := ExtractStructTable subsetControlTableToOnlySimulationsYetToBeCompletedIEModelled $"(Remaining_simulations)";
    }};

    //
    // ===
    // Iterate over each row of the simulation control table performing the specifcied 
    // simulation 
    @collapsed = no
    @alias = Simulation iteration
    _ := ForEach subsettedControlTable subsettedControlTable {{
        step = step;

        @viewer.step = yes
        simulationNumber := Step step;

        @collapsed = no
        @alias = Set working directory
        Workdir specifyWorkingDirectoryFromR {{
            workdir = workdir;

            @collapsed = no
            @viewer.executionCompletedSucessfully = yes
            skipOnError1399 := SkipOnError .yes {{
                @collapsed = no
                @alias = Initialise scenario
                _ := Group .none {{
                    // Prepare maps, create folders and pass back file paths for current simulation 
                    @collapsed = no
                    @viewer.result = yes
                    initializeCurrentSimulation := CalculateRExpression "IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMgRGluYW1pY2FfaW50aWFsaXplOiBJbml0aWFsaXplIG1vZGVsIHJ1biBzcGVjaWZpY2F0aW9ucyBpbiBEaW5hbWljYSAgCiMjIERhdGU6IDI1LTAyLTIwMjIKIyMgQXV0aG9yOiBCZW4gQmxhY2sKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBBLSBQcmVwYXJhdGlvbgojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKIyBJbnN0YWxsIHBhY2thZ2VzIGlmIHRoZXkgYXJlIG5vdCBhbHJlYWR5IGluc3RhbGxlZApwYWNrczwtYygiZGF0YS50YWJsZSIsInN0cmluZ2kiLCJzdHJpbmdyIiwicGx5ciIsInJlYWR4bCIsICJnZ3B1YnIiLAogICAgICAgICAicmxpc3QiLCAidGlkeXZlcnNlIiwgInJzdGF0aXgiLCAiRGluYW1pY2EiLCAicmFzdGVyIiwgIm9wZW54bHN4IikKCm5ldy5wYWNrczwtcGFja3NbIShwYWNrcyAlaW4lIGluc3RhbGxlZC5wYWNrYWdlcygpWywiUGFja2FnZSJdKV0KCmlmKGxlbmd0aChuZXcucGFja3MpKSBpbnN0YWxsLnBhY2thZ2VzKG5ldy5wYWNrcykKCiMgTG9hZCByZXF1aXJlZCBwYWNrYWdlcwppbnZpc2libGUobGFwcGx5KHBhY2tzLCByZXF1aXJlLCBjaGFyYWN0ZXIub25seSA9IFRSVUUpKQoKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyMjIEItIFJlY2VpdmUgbW9kZWwgc3BlY2lmaWNhdGlvbnMKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiNyZWNlaXZlIHdvcmtpbmcgZGlyZWN0b3J5CndwYXRoIDwtIHMyCnNldHdkKHdwYXRoKQoKI3NlbmQgbW9kZWwgdG9vbCB2YXJzIHRvIGdsb2JhbCBlbnZpcm9ubWVudApsaXN0MmVudihyZWFkUkRTKCJUb29scy9Nb2RlbF90b29sX3ZhcnMucmRzIiksIC5HbG9iYWxFbnYpCgojc2ltdWxhdGlvbiBudW1iZXIgYmVpbmcgcGVyZm9ybWVkClNpbXVsYXRpb25fbnVtIDwtIHYxCgojbG9hZCB0YWJsZSBvZiBzaW11bGF0aW9ucwpDb250cm9sX3RhYmxlX3BhdGggPC0gczEKU2ltdWxhdGlvbl90YWJsZSA8LSByZWFkLmNzdihDb250cm9sX3RhYmxlX3BhdGgpW1NpbXVsYXRpb25fbnVtLF0KCiNFbnRlciBuYW1lIG9mIFNjZW5hcmlvIHRvIGJlIHRlc3RlZCBhcyBzdHJpbmcgb3IgbnVtZXJpYyAoaS5lLiAiQkFVIiBldGMuKSAKU2NlbmFyaW9fSUQgPC0gU2ltdWxhdGlvbl90YWJsZSRTY2VuYXJpb19JRC5zdHJpbmcKCiNFbnRlciBhbiBJRCBmb3IgdGhpcyBydW4gb2YgdGhlIHNjZW5hcmlvIChlLmcgVjEpClNpbXVsYXRpb25fSUQgPC0gU2ltdWxhdGlvbl90YWJsZSRTaW11bGF0aW9uX0lELnN0cmluZwoKI0RlZmluZSBtb2RlbF9tb2RlOiBDYWxpYnJhdGlvbiBvciBTaW11bGF0aW9uCk1vZGVsX21vZGUgPC0gU2ltdWxhdGlvbl90YWJsZSRNb2RlbF9tb2RlLnN0cmluZwoKI0dldCBzdGFydCBhbmQgZW5kIGRhdGVzIG9mIHNjZW5hcmlvIChudW1lcmljKQpTY2VuYXJpb19zdGFydCA8LSBTaW11bGF0aW9uX3RhYmxlJFNjZW5hcmlvX3N0YXJ0LnJlYWwKU2NlbmFyaW9fZW5kIDwtIFNpbXVsYXRpb25fdGFibGUkU2NlbmFyaW9fZW5kLnJlYWwgCgojRW50ZXIgZHVyYXRpb24gb2YgdGltZSBzdGVwIGZvciBtb2RlbGxpbmcKU3RlcF9sZW5ndGggPC0gU2ltdWxhdGlvbl90YWJsZSRTdGVwX2xlbmd0aC5yZWFsCgojc3BlY2lmeSBzYXZlIGxvY2F0aW9uIGZvciBzaW11bGF0ZWQgTFVMQyBtYXBzIChyZXBsYWNlIHF1b3RlZCBzZWN0aW9uKQojZm9sZGVyIHBhdGggYmFzZWQgdXBvbiBTY2VuYXJpbyBhbmQgU2ltdWxhdGlvbiBJRCdzCnNpbXVsYXRlZF9MVUxDX2ZvbGRlcl9wYXRoIDwtIHBhc3RlKHdwYXRoLCAiUmVzdWx0cy9EaW5hbWljYV9zaW11bGF0ZWRfTFVMQyIsIFNjZW5hcmlvX0lELCBTaW11bGF0aW9uX0lELCBzZXAgPSAiLyIpIAoKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyMjIEMtIFdvcmsgRGlyIGFuZCBtb2RlbCBtb2RlIGluaXRpYWxpemF0aW9uCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cgojc2VuZCBzdGVwIGxlbmd0aApvdXRwdXREb3VibGUoIlN0ZXBfbGVuZ3RoIiwgU3RlcF9sZW5ndGgpICAKICAKI1NlbmQgU2ltdWxhdGlvbiBJRApvdXRwdXRTdHJpbmcoIlNpbV9pZCIsIFNpbXVsYXRpb25fSUQpCiAgCiNzZW5kIE1vZGVsIG1vZGUKb3V0cHV0U3RyaW5nKCJNb2RlbF9tb2RlIiwgTW9kZWxfbW9kZSkKCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBELSBNb2RlbCB0aW1lIHN0ZXAgCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgCiN1c2Ugc3RhcnQgYW5kIGVuZCB0aW1lIHRvIGdlbmVyYXRlIGEgbG9va3VwIHRhYmxlIG9mIGRhdGVzIHNlcGVyYXRlZCBieSA1IHllYXJzIAptb2RlbF90aW1lX3N0ZXBzIDwtIGxpc3QoIEtleXMgPSBjKHNlcShTY2VuYXJpb19zdGFydCwgU2NlbmFyaW9fZW5kLTUsIFN0ZXBfbGVuZ3RoKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWVzID0gYyhzZXEoKFNjZW5hcmlvX3N0YXJ0KzUpLCAoU2NlbmFyaW9fZW5kKSwgU3RlcF9sZW5ndGgpKSkKCiNzZW5kIE1vZGVsIHRpbWUgc3RlcCB0YWJsZSB0byBEaW5hbWljYSByZWNlaXZlcjogc2ltdWxhdGlvbl90aW1lX3N0ZXBzCm91dHB1dExvb2t1cFRhYmxlKCJzaW11bGF0aW9uX3RpbWVfc3RlcHMiLCBtb2RlbF90aW1lX3N0ZXBzJEtleXMsIG1vZGVsX3RpbWVfc3RlcHMkVmFsdWVzKQoKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyMjIEUtIExVTEMgbWFwIGluaXRpYWxpemF0aW9uICsgZ2xhY2llciBjb252ZXJzaW9uICAgCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgojQ2hlY2sgaWYgZGlyZWN0b3J5IGZvciBzYXZpbmcgTFVMQyBtYXBzIGV4aXN0cywgaWYgbm90IGNyZWF0ZSBpdC4KI3JlcXVpcmVzIHVzZSBvZiBhYnNvbHV0ZSBwYXRocwppZiAoZGlyLmV4aXN0cyhzaW11bGF0ZWRfTFVMQ19mb2xkZXJfcGF0aCkgPT0gVFJVRSkgeyJMVUxDIGZvbGRlciBhbHJlYWR5IGV4aXN0cyJ9IGVsc2UgewogIGRpci5jcmVhdGUoc2ltdWxhdGVkX0xVTENfZm9sZGVyX3BhdGgsIHJlY3Vyc2l2ZSA9IFRSVUUpfQoKI0NyZWF0ZSByZWxhdGl2ZSBmaWxlIHBhdGggZm9yIHNpbXVsYXRlZCBMVUxDIG1hcHMsIGJ1aWxkaW5nIG9uIGZvbGRlciBwYXRoIAojIG5vIG5lZWQgdG8gaW5jbHVkZSBEaW5hbWljYSdzIGVzY2FwZSBzdHJpbmcgYmVjYXVzZSBhbiBSIHNjcmlwdCBpcyB1c2VkIHRvIG1vZGlmeSBmb3IgdGhlIGNvcnJlY3QgdGltZSBzdGVwCnNpbXVsYXRlZF9MVUxDX2ZpbGVfcGF0aCA8LSBwYXN0ZTAoc2ltdWxhdGVkX0xVTENfZm9sZGVyX3BhdGgsICIvIiwgInNpbXVsYXRlZF9MVUxDX3NjZW5hcmlvXyIsIFNjZW5hcmlvX0lELCAiX3NpbUlEXyIsIFNpbXVsYXRpb25fSUQsICJfeWVhcl8iKQoKI3NlbmQgc2ltdWxhdGVkIExVTEMgZm9sZGVyIHBhdGggdG8gRGluYW1pY2EgcmVjZWl2ZXI6IHNpbV9sdWxjX2ZvbGRlcl9wYXRoCm91dHB1dFN0cmluZygic2ltX2x1bGNfZm9sZGVyX3BhdGgiLCBzaW11bGF0ZWRfTFVMQ19maWxlX3BhdGgpCgojdXNlIFNpbXVsYXRpb24gc3RhcnQgdGltZSB0byBzZWxlY3QgZmlsZSBwYXRoIG9mIGluaXRpYWwgTFVMQyBtYXAKT2JzX0xVTENfcGF0aHMgPC0gbGlzdC5maWxlcygiRGF0YS9IaXN0b3JpY19MVUxDIiwgZnVsbC5uYW1lcyA9IFRSVUUsIHBhdHRlcm4gPSAiLmdyaSIpCgojZXh0cmFjdCBudW1lcmljcwpPYnNfTFVMQ195ZWFycyA8LSB1bmlxdWUoYXMubnVtZXJpYyhnc3ViKCIuKj8oWzAtOV0rKS4qIiwgIlxcMSIsIE9ic19MVUxDX3BhdGhzKSkpCgojdmVjdG9yIGZpbGUgcGF0aCBmb3Igc2F2aW5nIHJhc3RlcgpzYXZlX3Jhc3Rlcl9wYXRoIDwtIHBhc3RlMChzaW11bGF0ZWRfTFVMQ19maWxlX3BhdGgsIFNjZW5hcmlvX3N0YXJ0LCAiLnRpZiIpCgojaWYgU2NlbmFyaW9fc3RhcnQgeWVhciBpcyA8PSAyMDIwIHRoZW4gaXQgcHJvYmFibHkgaGFzbid0IGJlZW4gcnVuIGJlZm9yZSBzbyB3ZQojbmVlZCB0byBjcmVhdGUgYSBjb3B5IG9mIHRoZSBpbml0aWFsIExVTEMgbWFwIHRvIHN0YXJ0IHRoZSBzaW11bGF0aW9uIHdpdGggCiMgdmljZSB2ZXJzYSBpZiBTY2VuYXJpb19zdGFydCB5ZWFyIGlzID4yMDIwIHRoZW4gdGhlIHNjZW5hcmlvIG1heSBoYXZlCiNiZWVuIHJ1biBwcmV2aW91c2x5IG9yIGhhdmUgYmVlbiBpbnRlcnJ1cHRlZCBieSBhbiBlcnJvciBzbyB0aGVyZSBpcyBubyBuZWVkCiN0byBjb3B5IHRoZSBzdGFydCBtYXAgYmVjYXVzZSBvbmUgd2lsbCBleGlzdCBidXQgdGhpcyBzdGlsbCBuZWVkcyB0byBiZSBjaGVja2VkCgppZihTY2VuYXJpb19zdGFydCA8PSAyMDIwKXsKICAKICAjSWRlbnRpZnkgc3RhcnQgeWVhcgogIExVTENfc3RhcnRfeWVhciA8LSBPYnNfTFVMQ195ZWFyc1tiYXNlOjp3aGljaC5taW4oYWJzKE9ic19MVUxDX3llYXJzIC0gU2NlbmFyaW9fc3RhcnQpKV0KIAogICNzdWJzZXQgdG8gY29ycmVjdCBMVUxDIHBhdGggYW5kIGxvYWQKICBJbml0aWFsX0xVTENfcmFzdGVyIDwtIHJhc3RlcihPYnNfTFVMQ19wYXRoc1tncmVwKExVTENfc3RhcnRfeWVhciwgT2JzX0xVTENfcGF0aHMpXSkgCiAgCiAgI2NvbnZlcnQgcmFzdGVyIHRvIGRhdGFmcmFtZQogIExVTENfZGF0IDwtIHJhc3Rlcjo6YXMuZGF0YS5mcmFtZShJbml0aWFsX0xVTENfcmFzdGVyKSAKCiAgI2FkZCBJRCBjb2x1bW4gdG8gZGF0YXNldAogIExVTENfZGF0JElEIDwtIHNlcS5pbnQobnJvdyhMVUxDX2RhdCkpCgogICNHZXQgWFkgY29vcmRpbmF0ZXMgb2YgY2VsbHMKICB4eV9jb29yZGluYXRlcyA8LSBjb29yZGluYXRlcyhJbml0aWFsX0xVTENfcmFzdGVyKSAKCiAgI2NiaW5kIFhZIGNvb3JkaW5hdGVzIHRvIGRhdGFmcmFtZSBhbmQgc2VwZXJhdGUgcm93cyB3aGVyZSBhbGwgdmFsdWVzID0gTkEKICBMVUxDX2RhdCA8LSBjYmluZChMVUxDX2RhdCwgeHlfY29vcmRpbmF0ZXMpCiAgCiAgI0ZvciB0aGUgc2ltdWxhdGlvbnMgaW4gb3JkZXIgZm9yIHRoZSB0cmFuc2l0aW9uIHJhdGVzIGZvciBnbGFjaWVycyB0byBiZQogICNhY2N1cmF0ZSB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSBpbml0aWFsIExVTEMgbWFwIGhhcyB0aGUgY29ycmVjdAogICNudW1iZXIgb2YgZ2xhY2llciBjZWxscyBhY2NvcmRpbmcgdG8gZ2xhY2lhbCBtb2RlbGxpbmcKICBpZihncmVwbCgic2ltdWxhdGlvbiIsIE1vZGVsX21vZGUsIGlnbm9yZS5jYXNlID0gVFJVRSkpewogIAogICAgICAjbG9hZCBzY2VuYXJpbyBzcGVjaWZpYyBnbGFjaWVyIGluZGV4CiAgICAgIEdsYWNpZXJfaW5kZXggPC0gcmVhZFJEUyhmaWxlID0gbGlzdC5maWxlcygiRGF0YS9HbGFjaWFsX2NoYW5nZS9TY2VuYXJpb19pbmRpY2VzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGwubmFtZXMgPSBUUlVFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybiA9IFNjZW5hcmlvX0lEKSlbLGMoIklEX2xvYyIsIHBhc3RlKFNjZW5hcmlvX3N0YXJ0KSldCgogICAgICAjc2VwZXJhdGUgdmVjdG9yIG9mIGNlbGwgSURzIGZvciBnbGFjaWVyIGFuZCBub24tZ2xhY2VyIGNlbGxzCiAgICAgIE5vbl9nbGFjaWVyX0lEcyA8LSBHbGFjaWVyX2luZGV4W0dsYWNpZXJfaW5kZXhbW3Bhc3RlKFNjZW5hcmlvX3N0YXJ0KV1dPT0wLCAiSURfbG9jIl0KICAgICAgR2xhY2llcl9JRHMgPC0gR2xhY2llcl9pbmRleFtHbGFjaWVyX2luZGV4W1twYXN0ZShTY2VuYXJpb19zdGFydCldXT09MSwgIklEX2xvYyJdIAogICAgCiAgICAgICNyZXBsYWNlIHRoZSAxJ3MgYW5kIDAncyB3aXRoIHRoZSBjb3JyZWN0IExVTEMgCiAgICAgIExVTENfZGF0W0xVTENfZGF0JElEICVpbiUgTm9uX2dsYWNpZXJfSURzLCAiUGl4ZWxfdmFsdWUiXSA8LSAxMQogICAgICBMVUxDX2RhdFtMVUxDX2RhdCRJRCAlaW4lIEdsYWNpZXJfSURzLCAiUGl4ZWxfdmFsdWUiXSA8LSAxOQogICAgICAKICAgICAgIzJuZCBzdGVwIGVuc3VyZSB0aGF0IG90aGVyIGdsYWNpYWwgY2VsbHMgdGhhdCBkbyBub3QgbWF0Y2ggdGhlIGdsYWNpZXIgaW5kZXgKICAgICAgI2FyZSBhbHNvIGNoYW5nZWQgdG8gc3RhdGljIHNvIHRoYXQgdGhlIHRyYW5zaXRpb24gcmF0ZXMgY2FsY3VsYXRlIHRoZQogICAgICAjY29ycmVjdCBudW1iZXIgb2YgY2VsbCBjaGFuZ2VzCiAgICAgIExVTENfZGF0W3doaWNoKExVTENfZGF0JFBpeGVsX3ZhbHVlID09IDE5ICYgIShMVUxDX2RhdCRJRCAlaW4lIEdsYWNpZXJfSURzKSksICJQaXhlbF92YWx1ZSJdIDwtIDExCiAgICAgIAogICAgICAjY29udmVydCBiYWNrIHRvIHJhc3RlcgogICAgICBJbml0aWFsX0xVTENfcmFzdGVyIDwtIHJhc3RlckZyb21YWVooTFVMQ19kYXRbLGMoIngiLCAieSIsICJQaXhlbF92YWx1ZSIpXSkgCiAgfSNjbG9zZSBpZiBzdGF0ZW1lbnQgZm9yIGdsYWNpYWwgbW9kaWZpY2F0aW9uCiAgCiAgI2NyZWF0ZSBhIGNvcHkgb2YgdGhlIGluaXRpYWwgTFVMQyByYXN0ZXIgZmlsZXMgaW4gdGhlIFNpbXVsYXRpb24gb3V0cHV0IGZvbGRlciBzbyB0aGF0IGl0IGNhbiBiZSBjYWxsZWQgd2l0aGluIERpbmFtaWNhLCAKICAjaXQgc2hvdWxkIGJlIG5hbWVkIHVzaW5nIHRoZSBmaWxlIHBhdGggZm9yIHNpbXVsYXRlZF9MVUxDIG1hcHMgKHNlZSBhYm92ZSkgYW5kIHRoZSBTaW11bGF0aW9uIHN0YXJ0IHllYXIKICB3cml0ZVJhc3RlcihJbml0aWFsX0xVTENfcmFzdGVyLCBzYXZlX3Jhc3Rlcl9wYXRoLCBvdmVyd3JpdGUgPSBUUlVFLCBkYXRhdHlwZSA9IklOVDFVIikKCiAgfSAjY2xvc2UgaWYgc3RhdGVtZW50IGZvciBjb3B5aW5nIGluaXRpYWwgTFVMQyByYXN0ZXIgCgojc2VuZCBpbml0aWFsIExVTEMgbWFwIGZpbGUgcGF0aCB0byBEaW5hbWljYSByZWNlaXZlcjogIApvdXRwdXRTdHJpbmcoImluaXRpYWxfbHVsY19wYXRoIiwgc2F2ZV9yYXN0ZXJfcGF0aCkKCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBGLSBTZW5kIGFsbG9jYXRpb24gcGFyYW1ldGVyIHRhYmxlIGZvbGRlciBwYXRoICAgCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgojYXBwZW5kIHRoZSBzdWZmaXggbmVjZXNzYXJ5IGZvciBEaW5hbWljYSB0byBhbHRlciBzdHJpbmdzICg8djE+KSB0byB0aGUgZmlsZSBuYW1lCmlmKGdyZXBsKCJzaW11bGF0aW9uIiwgTW9kZWxfbW9kZSwgaWdub3JlLmNhc2UgPSBUUlVFKSl7ClBhcmFtc19mb2xkZXJfRGluYW1pY2EgPC0gcGFzdGUwKFNpbXVsYXRpb25fcGFyYW1fZGlyLCAiLyIsIFNjZW5hcmlvX0lELCAiL0FsbG9jYXRpb25fcGFyYW1fdGFibGVfPHYxPi5jc3YiKQp9IGVsc2UgaWYoZ3JlcGwoImNhbGlicmF0aW9uIiwgTW9kZWxfbW9kZSwgaWdub3JlLmNhc2UgPSBUUlVFKSl7ClBhcmFtc19mb2xkZXJfRGluYW1pY2EgPC0gcGFzdGUwKENhbGlicmF0aW9uX3BhcmFtX2RpciwiLyIsIFNpbXVsYXRpb25fSUQsICIvQWxsb2NhdGlvbl9wYXJhbV90YWJsZV88djE+LmNzdiIpICAKfQoKI3NlbmQgZm9sZGVyIHBhdGggYXMgc3RyaW5nIHRvIERpbmFtaWNhIHJlY2VpdmVyOiB0cmFuc19tYXRyaXhfZm9sZGVyX3BhdGgKb3V0cHV0U3RyaW5nKCJBbGxvY2F0aW9uX3BhcmFtc19mb2xkZXJfcGF0aCIsIFBhcmFtc19mb2xkZXJfRGluYW1pY2EpCg==" .no {{
                        @alias = File path of control table
                        NumberString specifyControlTableFilePathTableConsistingOfColumnsSpecifyingTheSimulationsToBePerformedEGScenariosLengthVersionsEtc 1;

                        @alias = Working directory
                        NumberString specifyWorkingDirectoryFromR 2;

                        @alias = Row of current simulation in table
                        NumberValue simulationNumber 1;
                    }};

                    @viewer.lookupTable = yes
                    receiveTableOfTimeStepsDefiningLengthOfSimulation := ExtractStructLookupTable initializeCurrentSimulation $"(simulation_time_steps)";

                    @viewer.string = yes
                    receiveInitialLulcFilePath := ExtractStructString initializeCurrentSimulation $"(initial_lulc_path)";

                    @viewer.string = yes
                    receiveFolderPathForTablesOfAllocationAlgorithmParameters := ExtractStructString initializeCurrentSimulation $"(Allocation_params_folder_path)";

                    stepLength := ExtractStructNumber initializeCurrentSimulation $"(Step_length)";

                    @viewer.string = yes
                    receiveFilePathForSimulatedLulcMaps := ExtractStructString initializeCurrentSimulation $"(sim_lulc_folder_path)";

                    receiveSimulationId := ExtractStructString initializeCurrentSimulation $"(Sim_id)";

                    receiveModelMode := ExtractStructString initializeCurrentSimulation $"(Model_mode)";
                }};

                @collapsed = no
                scenarioTimeStepIteration := ForEach receiveTableOfTimeStepsDefiningLengthOfSimulation receiveTableOfTimeStepsDefiningLengthOfSimulation {{
                    step0 = step;

                    // Receives current model time step 
                    @viewer.step = yes
                    timeStep := Step step0;

                    @alias = Transition rate table control
                    _ := Group .none {{
                        @collapsed = no
                        loadTransitionRateTable := CalculateRExpression "IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMgRGluYW1pY2FfbG9hZF90cmFuc19tYXRyaXg6IExvYWQgU2NlbmFyaW8vdGltZSBzcGVjaWZpYyB0cmFuc2l0aW9uIG1hdHJpeCAKIyMgYW5kIHVwZGF0ZSB0byByZWZsZWN0IGFueSBkZXRlcm1pbmlzdGljIHRyYW5zaXRpb25zCiMjIERhdGU6IDAzLTA1LTIwMjMKIyMgQXV0aG9yOiBCZW4gQmxhY2sKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBBLSBQcmVwYXJhdGlvbgojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKI3JlY2VpdmUgd29ya2luZyBkaXJlY3RvcnkKd3BhdGggPC0gczEKI3dwYXRoIDwtIGdldHdkKCkKc2V0d2Qod3BhdGgpCgojVmVjdG9yIHBhY2thZ2VzIGZvciBsb2FkaW5nCnBhY2tzPC1jKCJkYXRhLnRhYmxlIiwgInJhc3RlciIsICJ0aWR5dmVyc2UiLCJzdHJpbmdyIiwgInJlYWRyIiwgInhsc3giLAogICAgICAgICAiRGluYW1pY2EiLCAicmVhZHhsIikKCm5ldy5wYWNrczwtcGFja3NbIShwYWNrcyAlaW4lIGluc3RhbGxlZC5wYWNrYWdlcygpWywiUGFja2FnZSJdKV0KaWYobGVuZ3RoKG5ldy5wYWNrcykpIGluc3RhbGwucGFja2FnZXMobmV3LnBhY2tzKQoKIyBMb2FkIHJlcXVpcmVkIHBhY2thZ2VzCmludmlzaWJsZShsYXBwbHkocGFja3MsIHJlcXVpcmUsIGNoYXJhY3Rlci5vbmx5ID0gVFJVRSkpCgojc2VuZCBtb2RlbCB0b29sIHZhcnMgdG8gZ2xvYmFsIGVudmlyb25tZW50Cmxpc3QyZW52KHJlYWRSRFMoIlRvb2xzL01vZGVsX3Rvb2xfdmFycy5yZHMiKSwgLkdsb2JhbEVudikKCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBCLSBSZWNlaXZlIGluZm9ybWF0aW9uIGZyb20gRGluYW1pY2EKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiN2YWx1ZXMgZm9yIHRlc3RpbmcgcHVycG9zZXMKIyBTaW11bGF0aW9uX3llYXIgPC0gIjIwMjUiCiMgU2ltdWxhdGlvbl9udW0gPC0gIjEiCgojUmVjZWl2ZSBjdXJyZW50IHNpbXVsYXRpb24gdGltZQpTaW11bGF0aW9uX3llYXIgPC0gdjEKCiNzaW11bGF0aW9uIG51bWJlciBiZWluZyBwZXJmb3JtZWQKU2ltdWxhdGlvbl9udW0gPC0gdjIKCiNsb2FkIHRhYmxlIG9mIHNpbXVsYXRpb25zCkNvbnRyb2xfdGFibGVfcGF0aCA8LSBzMgpTaW11bGF0aW9uX3RhYmxlIDwtIHJlYWQuY3N2KENvbnRyb2xfdGFibGVfcGF0aClbU2ltdWxhdGlvbl9udW0sXQoKI1ZlY3RvciBuYW1lIG9mIFNjZW5hcmlvIHRvIGJlIHRlc3RlZCBhcyBzdHJpbmcgb3IgbnVtZXJpYyAoaS5lLiAiQkFVIiBldGMuKSAKU2NlbmFyaW9fSUQgPC0gU2ltdWxhdGlvbl90YWJsZSRTY2VuYXJpb19JRC5zdHJpbmcKCiNWZWN0b3IgSUQgZm9yIHRoaXMgcnVuIG9mIHRoZSBzY2VuYXJpbyAoZS5nIFYxKQpTaW11bGF0aW9uX0lEIDwtIFNpbXVsYXRpb25fdGFibGUkU2ltdWxhdGlvbl9JRC5zdHJpbmcKCiNEZWZpbmUgbW9kZWxfbW9kZTogQ2FsaWJyYXRpb24gb3IgU2ltdWxhdGlvbgpNb2RlbF9tb2RlIDwtIFNpbXVsYXRpb25fdGFibGUkTW9kZWxfbW9kZS5zdHJpbmcKCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBCLSBMb2FkIFRyYW5zaXRpb24gcmF0ZSB0YWJsZSBhbmQgCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgojdXNlIHNjZW5hcmlvIElEIHRvIGdyYWIgZm9sZGVyIHBhdGggb2Ygc2NlbmFyaW8gc3BlY2lmaWMgdHJhbnNpdGlvbiB0YWJsZXMKU2NlbmFyaW9fdHJhbnNfdGFibGVfZGlyIDwtIHN0cl9yZXBsYWNlKChsaXN0LmZpbGVzKFRyYW5zX3JhdGVfdGFibGVfZGlyLCBwYXR0ZXJuID0gU2NlbmFyaW9fSUQsIGZ1bGwubmFtZXMgPSBUUlVFKSksIHBhc3RlMCh3cGF0aCwgIi8iKSwgIiIpCgojVXNlIGZvbGRlciBwYXRoIHRvIGNyZWF0ZSBhIGdlbmVyaWMgc2NlbmFyaW8gc3BlY2lmaWMgdHJhbnNpdGlvbiBtYXRyaXggZmlsZSBwYXRoClNjZW5hcmlvX3RyYW5zX3RhYmxlX2ZpbGUgPC0gcGFzdGUwKFNjZW5hcmlvX3RyYW5zX3RhYmxlX2RpciwgIi8iLCBTY2VuYXJpb19JRCwgIl8iLCAidHJhbnNfdGFibGUiLCAiXyIsIFNpbXVsYXRpb25feWVhciwgIi5jc3YiKQoKI2xvYWQgdGhlIHRhYmxlClRyYW5zX3RhYmxlIDwtIHJlYWRfY3N2KFNjZW5hcmlvX3RyYW5zX3RhYmxlX2ZpbGUpCgojaWYgc3RhdGVtZW50IHRvIHJlbW92ZSB0cmFuc2l0aW9ucyBpZiB0aGV5IGFyZSBiZWluZyBpbXBsZW1lbnRlZCBkZXRlcm1pbmlzdGljbHkKaWYoZ3JlcGwoInNpbXVsYXRpb24iLCBNb2RlbF9tb2RlLCBpZ25vcmUuY2FzZSA9IFRSVUUpICYKICAgIGdyZXBsKCJZIiwgU2ltdWxhdGlvbl90YWJsZSREZXRlcm1pbmlzdGljX3RyYW5zLnN0cmluZywgaWdub3JlLmNhc2UgPSBUUlVFKSl7CgogICNyZW1vdmUgdHJhbnNpdGlvbnMgd2l0aCBpbml0aWFsIGNsYXNzID09IGdsYWNpZXIKICBUcmFuc190YWJsZSA8LSBUcmFuc190YWJsZVtUcmFuc190YWJsZSRgRnJvbSpgICE9IDE5LF0KCn0gI2Nsb3NlIGlmIHN0YXRlbWVudAoKI091dHB1dCB0YWJsZSB0byBEaW5hbWljYQpvdXRwdXRUYWJsZSgiVHJhbnNfcmF0ZV90YWJsZSIsIFRyYW5zX3RhYmxlKQ==" .no {{
                            @alias = Working directory
                            NumberString specifyWorkingDirectoryFromR 1;

                            @alias = File path of control table
                            NumberString specifyControlTableFilePathTableConsistingOfColumnsSpecifyingTheSimulationsToBePerformedEGScenariosLengthVersionsEtc 2;

                            @alias = Time step
                            NumberValue timeStep 1;

                            @alias = Simulation number
                            NumberValue simulationNumber 2;
                        }};

                        transitionRatesTable := ExtractStructTable loadTransitionRateTable $"(Trans_rate_table)";
                    }};

                    @viewer.map = yes
                    loadInitialLulcMap := LoadCategoricalMap {
                        filename = receiveInitialLulcFilePath,
                        nullValue = .none,
                        storageMode = .default,
                        suffixDigits = 0,
                        step = step0,
                        workdir = workdir
                    };

                    // simulated LULC map updated for each time step 
                    @viewer.map = yes
                    updatedLulcMap := MuxCategoricalMap loadInitialLulcMap loadUpdatedLulcMap;

                    @alias = Load allocation parameters
                    _ := Group .none {{
                        @collapsed = no
                        @viewer.result = yes
                        modifyFilePathForAllocationParametersTableForTimeStep := CreateString receiveFolderPathForTablesOfAllocationAlgorithmParameters {{
                            @alias = Time step
                            NumberValue timeStep 1;
                        }};

                        @viewer.table = yes
                        loadTableOfAllocationParameters := LoadTable {
                            filename = modifyFilePathForAllocationParametersTableForTimeStep,
                            uniqueIdKeyColumnCreation = .ifNecessary,
                            suffixDigits = 0,
                            step = step0,
                            workdir = workdir
                        };

                        @collapsed = no
                        @viewer.result = yes
                        splitParamTable := CalculateRExpression "I1JlY2VpdmUgcGFyYW1ldGVyIHRhYmxlClBhcmFtX3RhYmxlIDwtIHQxCgojc3Vic2V0IHRvIGNvbHVtbnMgcmVxdWlyZWQgZm9yICVleHBhbmRlciBpbnB1dApFeHBhbmRlcl90YWJsZSA8LSBQYXJhbV90YWJsZVssIGMoIkZyb20iLCAiVG8iLCAiUGVyY19leHBhbmRlciIpXQoKI3N1YnNldCB0byBjb2x1bW5zIHJlcXVpcmVkIGZvciBwYXRjaCBnZW5lcmF0aW9uIGlucHV0ClBhdGNoX3RhYmxlIDwtIFBhcmFtX3RhYmxlWywhKGNvbG5hbWVzKFBhcmFtX3RhYmxlKSAlaW4lIGMoIlBlcmNfZXhwYW5kZXIiLCAiUGVyY19wYXRjaGVyIikpXQoKI091dHB1dCAlIEV4cGFuc2lvbiB0YWJsZQojKE5vdGUgdGhlICcsMicgcGFyYW1ldGVyIGlzIG5lY2Vzc2FyeSBmb3IgRGluYW1pY2EgdG8gcmVnaXN0ZXIgdGhhdCB0aGUgdGFibGUgaGFzIDIga2V5IGNvbHVtbnMgKEZyb20gYW5kIFRvKSkKb3V0cHV0VGFibGUoIkV4cGFuZGVyX3RhYmxlIiwgRXhwYW5kZXJfdGFibGUsIDIpCm91dHB1dFRhYmxlKCJQYXRjaF90YWJsZSIsIFBhdGNoX3RhYmxlLCAyKQo=" .no {{
                            NumberTable loadTableOfAllocationParameters 1;
                        }};

                        @viewer.table = yes
                        patchRelatedParams := ExtractStructTable splitParamTable $"(Patch_table)";

                        @alias = % expansion table
                        @viewer.table = yes
                        expansionTable := ExtractStructTable splitParamTable $"(Expander_table)";
                    }};

                    @collapsed = no
                    @alias = Transition potential calculation
                    _ := Group .none {{
                        @collapsed = no
                        @alias = Transition potential R script
                        transitionPotentialRScript := CalculateRExpression "IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMgRGluYW1pY2FfdHJhbnNfcG90ZW50X2NhbGM6IFRlc3RpbmcgcGFyYWxsZWxpemF0aW9uIG9mIHRyYW5zaXRpb24gCiMjIHBvdGVudGlhbCBjYWxjdWxhdGlvbgojIyBEYXRlOiAyNS0wMi0yMDIyCiMjIEF1dGhvcjogQmVuIEJsYWNrCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIyMgQS0gUHJlcGFyYXRpb24KIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiNyZWNlaXZlIHdvcmtpbmcgZGlyZWN0b3J5CndwYXRoIDwtIHMzCnNldHdkKHdwYXRoKQoKI1ZlY3RvciBwYWNrYWdlcyBmb3IgbG9hZGluZwpwYWNrczwtYygiZm9yZWFjaCIsICJkYXRhLnRhYmxlIiwgInJhc3RlciIsICJ0aWR5dmVyc2UiLAogICAgICAgICAidGVzdHRoYXQiLCAic2ptaXNjIiwgInRpY3RvYyIsICJkb1BhcmFsbGVsIiwgImNhbGxyIiwKICAgICAgICAgImx1bGNjIiwgInBiYXBwbHkiLCAic3RyaW5nciIsICJyZWFkciIsICJ4bHN4IiwgInJhbmRvbUZvcmVzdCIsCiAgICAgICAgICJEaW5hbWljYSIsICJmdXR1cmUiLCAiZnV0dXJlLmFwcGx5IiwgInBhcmFsbGVsbHkiLCAiZnV0dXJlLmNhbGxyIiwgInJlYWR4bCIpCgpuZXcucGFja3M8LXBhY2tzWyEocGFja3MgJWluJSBpbnN0YWxsZWQucGFja2FnZXMoKVssIlBhY2thZ2UiXSldCmlmKGxlbmd0aChuZXcucGFja3MpKSBpbnN0YWxsLnBhY2thZ2VzKG5ldy5wYWNrcykKCiMgTG9hZCByZXF1aXJlZCBwYWNrYWdlcwppbnZpc2libGUobGFwcGx5KHBhY2tzLCByZXF1aXJlLCBjaGFyYWN0ZXIub25seSA9IFRSVUUpKQoKI2xvYWQgZnVuY3Rpb24gZm9yIHNwYXRpYWwgdHJhbnNpdGlvbiBwcm9iYWJpbGl0eSBtYW5pcHVsYXRpb24KaW52aXNpYmxlKHNvdXJjZSgiU2NyaXB0cy9GdW5jdGlvbnMvbHVsY2Muc3BhdHByb2JtYW5pcHVsYXRpb24uUiIpKQoKI3NlbmQgbW9kZWwgdG9vbCB2YXJzIHRvIGdsb2JhbCBlbnZpcm9ubWVudApsaXN0MmVudihyZWFkUkRTKCJUb29scy9Nb2RlbF90b29sX3ZhcnMucmRzIiksIC5HbG9iYWxFbnYpCgojTG9hZCBpbiB0aGUgZ3JpZCBmaWxlIHdlIGFyZSB1c2luZyBmb3Igc3BhdGlhbCBleHRlbnQgYW5kIENSUwpSZWZfZ3JpZCA8LSByYXN0ZXIoUmVmX2dyaWRfcGF0aCkKCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBCLSBSZWNlaXZlIGluZm9ybWF0aW9uIGZyb20gRGluYW1pY2EKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiNSZWNlaXZlIGN1cnJlbnQgc2ltdWxhdGlvbiB0aW1lClNpbXVsYXRpb25fdGltZV9zdGVwIDwtIHYxCgojc2ltdWxhdGlvbiBudW1iZXIgYmVpbmcgcGVyZm9ybWVkClNpbXVsYXRpb25fbnVtIDwtIHYyCgojbG9hZCB0YWJsZSBvZiBzaW11bGF0aW9ucwpDb250cm9sX3RhYmxlX3BhdGggPC0gczEKU2ltdWxhdGlvbl90YWJsZSA8LSByZWFkLmNzdihDb250cm9sX3RhYmxlX3BhdGgpW1NpbXVsYXRpb25fbnVtLF0KCiNWZWN0b3IgbmFtZSBvZiBTY2VuYXJpbyB0byBiZSB0ZXN0ZWQgYXMgc3RyaW5nIG9yIG51bWVyaWMgKGkuZS4gIkJBVSIgZXRjLikgClNjZW5hcmlvX0lEIDwtIFNpbXVsYXRpb25fdGFibGUkU2NlbmFyaW9fSUQuc3RyaW5nCgojVmVjdG9yIGFuIElEIGZvciB0aGlzIHJ1biBvZiB0aGUgc2NlbmFyaW8gKGUuZyBWMSkKU2ltdWxhdGlvbl9JRCA8LSBTaW11bGF0aW9uX3RhYmxlJFNpbXVsYXRpb25fSUQuc3RyaW5nCgojRGVmaW5lIG1vZGVsX21vZGU6IENhbGlicmF0aW9uIG9yIFNpbXVsYXRpb24KTW9kZWxfbW9kZSA8LSBTaW11bGF0aW9uX3RhYmxlJE1vZGVsX21vZGUuc3RyaW5nCgojUmVjZWl2ZSBmb2xkZXIgcGF0aCBmb3IgbG9hZGluZyBzaW11bGF0ZWQgTFVMQyBtYXBzIApGaWxlX3BhdGhfc2ltdWxhdGVkX0xVTENfbWFwcyA8LSBzMgoKI1VzZSBwYXJhbGxlbCBwcm9jZXNzaW5nIGZvciB0cmFuc2l0aW9uIHBvdGVudGlhbCBjYWxjdWxhdGlvbgpVc2VfcGFyYWxsZWwgPC0gU2ltdWxhdGlvbl90YWJsZSRQYXJhbGxlbF9UUEMuc3RyaW5nCgpVc2VfaW50ZXJ2ZW50aW9ucyA8LSBTaW11bGF0aW9uX3RhYmxlJFNwYXRpYWxfaW50ZXJ2ZW50aW9ucy5zdHJpbmcKCiNDb252ZXJ0IG1vZGVsIG1vZGUgaW50byBhIHN0cmluZyBvZiB0aGUgZGF0ZXMgY2FsaWJyYXRpb24gcGVyaW9kIGJlaW5nIHVzZWQKI3RoaXMgbWFrZXMgaXQgZWFzaWVyIHRvIGxvYWQgZmlsZXMgYmVjYXVzZSB0aGV5IHVzZSB0aGlzIG5vbWVuY2xhdHVyZQoKQ2FsaWJyYXRpb25fcGVyaW9kcyA8LSB1bmlxdWUocmVhZHhsOjpyZWFkX2V4Y2VsKE1vZGVsX3NwZWNzX3BhdGgpW1siRGF0YV9wZXJpb2RfbmFtZSJdXSkKCkNhbGlicmF0aW9uX2RhdGVzIDwtIGxhcHBseShDYWxpYnJhdGlvbl9wZXJpb2RzLCBmdW5jdGlvbihwZXJpb2QpewogIGRhdGVzIDwtIGFzLm51bWVyaWMoc3RyX3NwbGl0KHBlcmlvZCwgIl8iKVtbMV1dKQp9KQoKUGVyaW9kX3RhZyA8LSBpZihncmVwbCgiY2FsaWJyYXRpb24iLCBNb2RlbF9tb2RlLCBpZ25vcmUuY2FzZSA9IFRSVUUpKXsKICBQZXJpb2RfbG9nIDwtIHNhcHBseShDYWxpYnJhdGlvbl9kYXRlcywgZnVuY3Rpb24oeCl7CiAgIGlmKFNpbXVsYXRpb25fdGltZV9zdGVwID4geFsxXSAmIFNpbXVsYXRpb25fdGltZV9zdGVwIDw9IHhbMl0pe1RSVUV9ZWxzZXtGQUxTRX0KICB9KQogIGlmKGFsbChQZXJpb2RfbG9nID09IEZBTFNFKT09VFJVRSl7CiAgICAjZmluZCB0aGUgY2xvc2V0IHllYXIKICAgIGNsb3Nlc3RfeWVhciA8LSB1bmxpc3QoQ2FsaWJyYXRpb25fZGF0ZXMpW3doaWNoLm1pbihhYnModW5saXN0KENhbGlicmF0aW9uX2RhdGVzKS1TaW11bGF0aW9uX3RpbWVfc3RlcCkpXQogICAgI21hdGNoIHllYXIgdG8gcGVyaW9kIG5hbWUKICAgIFBlcmlvZF9sb2cgPC0gQ2FsaWJyYXRpb25fcGVyaW9kc1tncmVwbChwYXN0ZTAoY2xvc2VzdF95ZWFyKSwgQ2FsaWJyYXRpb25fcGVyaW9kcyldCiAgICB9ZWxzZXtDYWxpYnJhdGlvbl9wZXJpb2RzW1BlcmlvZF9sb2c9PVRSVUVdfQogIH1lbHNlIGlmIChncmVwbCgic2ltdWxhdGlvbiIsIE1vZGVsX21vZGUsIGlnbm9yZS5jYXNlID0gVFJVRSkpe0NhbGlicmF0aW9uX3BlcmlvZHNbbGVuZ3RoKENhbGlicmF0aW9uX3BlcmlvZHMpXX0KI1RoZSBsYXN0IGNsYXVzZSBjb3ZlcnMgd2hlbiBjYWxpYnJhdGlvbiBpcyBvY2N1cmluZyBiZXR3ZWVuIDIwMDkgYW5kIDIwMTgKI2FuZCB3aGVuIHRoZSBtb2RlbCBpcyBpbiBzaW11bGF0aW9uIG1vZGUKCiNjcmVhdGUgZm9sZGVyIGZvciBzYXZpbmcgcHJlZGljdGlvbiBwcm9iYWJpbGl0eSBtYXBzCnByb2JfbWFwX2ZvbGRlciA8LSBwYXN0ZTAod3BhdGgsICIvUmVzdWx0cy9QcmVkX3Byb2JfbWFwcy8iLCBTY2VuYXJpb19JRCwgIi8iLCBTaW11bGF0aW9uX0lELCAiLyIsIFNpbXVsYXRpb25fdGltZV9zdGVwKQpzdXBwcmVzc1dhcm5pbmdzKGRpci5jcmVhdGUocHJvYl9tYXBfZm9sZGVyLCByZWN1cnNpdmUgPSBUUlVFKSkKCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBDLSBSZXRyaWV2ZSBjdXJyZW50IExVTEMgbWFwIGFuZCBzcGxpdCBpbnRvIHJlZ2lvbmFsaXplZCB0cmFuc2l0aW9uIGxheWVycwojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKI3JlcGxhY2UgRGluYW1pY2EgZXNjYXBlIGNoYXJhY3RlciBpbiBmaWxlIHBhdGggd2l0aCBjdXJyZW50IHRpbWUgc3RlcApjdXJyZW50X0xVTENfcGF0aCA8LSBwYXN0ZTAoRmlsZV9wYXRoX3NpbXVsYXRlZF9MVUxDX21hcHMsIFNpbXVsYXRpb25fdGltZV9zdGVwLCAiLnRpZiIpCgojbG9hZCBjdXJyZW50IExVTEMgbWFwIApDdXJyZW50X0xVTEMgPC0gcmFzdGVyKGN1cnJlbnRfTFVMQ19wYXRoKQoKI2xvYWQgYWdncmVnYXRpb24gc2NoZW1lCkFnZ3JlZ2F0aW9uX3NjaGVtZSA8LSByZWFkX2V4Y2VsKExVTENfYWdncmVnYXRpb25fcGF0aCkKCkxVTENfcmF0IDwtIEFnZ3JlZ2F0aW9uX3NjaGVtZSU+JSBkaXN0aW5jdChBZ2dyZWdhdGVkX0lELCAua2VlcF9hbGw9VFJVRSkKTFVMQ19yYXQgPC0gTFVMQ19yYXRbLCBjKCJDbGFzc19hYmJyZXZpYXRpb24iLCAiQWdncmVnYXRlZF9JRCIpXQoKI2xheWVyaXplIGRhdGEgKGNvbHVtbnMgZm9yIGVhY2ggTFVMQyBjbGFzcykKTFVMQ19kYXRhIDwtIHJhc3Rlcjo6bGF5ZXJpemUoQ3VycmVudF9MVUxDKQpuYW1lcyhMVUxDX2RhdGEpIDwtIHNhcHBseShzdHJfcmVtb3ZlX2FsbChuYW1lcyhMVUxDX2RhdGEpLCAiWCIpLCBmdW5jdGlvbih5KSB7CiAgTFVMQ19yYXRbTFVMQ19yYXQkQWdncmVnYXRlZF9JRCA9PSB5LCAiQ2xhc3NfYWJicmV2aWF0aW9uIl0KfSkKCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBELSBMb2FkIFN1aXRhYmlsaXR5IGFuZCBBY2Nlc3NpYmlsaXR5IHByZWRpY3RvcnMgYW5kIGF0dGFjaCB0byBMVUxDIGRhdGEKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiN1c2UgbW9kZWwgbW9kZSBzdHJpbmcgdG8gc2VsZWN0IGNvcnJlY3QgZm9sZGVyCgojRm9yIGNhbGlicmF0aW9uIG1vZGUgKG1hdGNoaW5nIG9uIFBlcmlvZF90YWcpCmlmIChncmVwbCgiY2FsaWJyYXRpb24iLCBNb2RlbF9tb2RlLCBpZ25vcmUuY2FzZSA9IFRSVUUpKXsKU0FfcHJlZF9zdGFjayA8LSByZWFkUkRTKGxpc3QuZmlsZXMoIkRhdGEvUHJlZHMvUHJlcGFyZWQvU3RhY2tzL0NhbGlicmF0aW9uIiwgcGF0dGVybiA9IFBlcmlvZF90YWcsIGZ1bGwubmFtZXMgPSBUUlVFKSkKfSAjY2xvc2UgaWYgc3RhdGVtZW50IGNhbGlicmF0aW9uCgojRm9yIHNpbXVsYXRpb24gbW9kZQppZiAoZ3JlcGwoInNpbXVsYXRpb24iLCBNb2RlbF9tb2RlLCBpZ25vcmUuY2FzZSA9IFRSVUUpKXsKICAKI2dldCBmaWxlIHBhdGggYnkgbWF0Y2hpbmcgb24gc2NlbmFyaW8gSUQgYW5kIHRpbWUgc3RlcCAKU0FfcHJlZF9zdGFjayA8LSByZWFkUkRTKGxpc3QuZmlsZXMoIkRhdGEvUHJlZHMvUHJlcGFyZWQvU3RhY2tzL1NpbXVsYXRpb24vU0FfcHJlZHMiLCBwYXR0ZXJuID0gcGFzdGUwKFNjZW5hcmlvX0lELCAiXyIsIFNpbXVsYXRpb25fdGltZV9zdGVwKSwgIGZ1bGwubmFtZXMgPSBUUlVFKSkKfSAjY2xvc2Ugc2ltdWxhdGlvbiBpZiBzdGF0ZW1lbnQKCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBFLSBHZW5lcmF0ZSBkeW5hbWljIHByZWRpY3RvcnMKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgRS4xLSBEeW5hbWljIHByZWRpY3RvcnM6ICBNdW5pY2lwYWwgUG9wdWxhdGlvbgojLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKI2ZvciBjYWxpYnJhdGlvbiB0aGUgcmFzdGVyIHN0YWNrcyBhbHJlYWR5IGNvbnRhaW4gdGhlIGR5bmFtaWMgcHJlZGljdG9yIGxheWVycyBzbyB0aGVyZQojaXMgbm90aGluZyB0byBiZSBkb25lCgojRm9yIHNpbXVsYXRpb24gbW9kZQppZiAoZ3JlcGwoInNpbXVsYXRpb24iLCBNb2RlbF9tb2RlLCBpZ25vcmUuY2FzZSA9IFRSVUUpKXsKCiAgI2NyZWF0ZSBwb3B1bGF0aW9uIGRhdGEgbGF5ZXIKICAjc3Vic2V0IGN1cnJlbnQgTFVMQyB0byBqdXN0IHVyYmFuIGNlbGxzCiAgVXJiYW5fcmFzdCA8LSBDdXJyZW50X0xVTEMgPT0gMTAKCiAgI2xvYWQgY2FudG9uIHNoYXBlZmlsZQogIENhbnRvbl9zaHAgPC0gc2hhcGVmaWxlKCJEYXRhL1ByZWRzL1Jhdy9DSF9nZW9tcy9TSEFQRUZJTEVfTFY5NV9MTjAyL3N3aXNzQk9VTkRBUklFUzNEXzFfM19UTE1fS0FOVE9OU0dFQklFVC5zaHAiKQoKICAjWm9uYWwgc3RhdHMgdG8gZ2V0IHVyYmFuIGFyZWEgcGVyIGthbnRvbgogIENhbnRvbl91cmJhbl9hcmVhcyA8LSByYXN0ZXI6OmV4dHJhY3QoVXJiYW5fcmFzdCwgQ2FudG9uX3NocCwgZnVuPXN1bSwgbmEucm09VFJVRSwgZGY9VFJVRSkKCiAgI2FwcGVuZCBLYW50b24gSUQgCiAgQ2FudG9uX3VyYmFuX2FyZWFzJENhbnRvbl9udW0gPC0gQ2FudG9uX3NocCRLQU5UT05TTlVNCgogICNjb21iaW5lIGFyZWFzIGZvciBjYW50b25zIHdpdGggbXVsdGlwbGUgcG9seWdvbnMKICBDYW50b25fdXJiYW5fYXJlYXMgPC0gQ2FudG9uX3VyYmFuX2FyZWFzICU+JQogIGdyb3VwX2J5KENhbnRvbl9udW0pICU+JQogIGRwbHlyOjpzdW1tYXJpc2UoYWNyb3NzKGMobGF5ZXIpLCBzdW0pKQoKICAjbG9hZCB0aGUgbXVuaWNpcGFsaXR5IHNoYXBlIGZpbGUKICBNdW5pX3NocCA8LSBzaGFwZWZpbGUoIkRhdGEvUHJlZHMvUmF3L0NIX2dlb21zL1NIQVBFRklMRV9MVjk1X0xOMDIvc3dpc3NCT1VOREFSSUVTM0RfMV8zX1RMTV9IT0hFSVRTR0VCSUVULnNocCIpCgogICNmaWx0ZXIgb3V0IG5vbi1zd2lzcyBtdW5pY2lwYWxpdGllcwogIE11bmlfc2hwIDwtIE11bmlfc2hwW011bmlfc2hwQGRhdGEkSUNDID09ICJDSCIgJiBNdW5pX3NocEBkYXRhJE9CSkVLVEFSVCA9PSAiR2VtZWluZGVnZWJpZXQiLCBdIAoKICAjWm9uYWwgc3RhdHMgdG8gZ2V0IG51bWJlciBvZiBVcmJhbiBjZWxscyBwZXIgTXVuaWNpcGFsaXR5IHBvbHlnb24KICAjc3VtIGlzIHVzZWQgYXMgYSBmdW5jdGlvbiBiZWNhdXNlIHVyYmFuIGNlbGxzID0gMSBhbGwgb3RoZXJzID0gMAogIE11bmlfdXJiYW5fYXJlYXMgPC0gcmFzdGVyOjpleHRyYWN0KFVyYmFuX3Jhc3QsIE11bmlfc2hwLCBmdW49c3VtLCBuYS5ybT1UUlVFLCBkZj1UUlVFKQogIAogICNhcHBlbmQgS2FudG9uIGFuZCBNdW5pY2lwYWxpdHkgSURzCiAgTXVuaV91cmJhbl9hcmVhcyRDYW50b25fbnVtIDwtIE11bmlfc2hwQGRhdGFbWyJLQU5UT05TTlVNIl1dCiAgTXVuaV91cmJhbl9hcmVhcyRNdW5pX251bSA8LSBNdW5pX3NocCRCRlNfTlVNTUVSCiAgTXVuaV91cmJhbl9hcmVhcyRQZXJjX3VyYmFuIDwtIDAKICAKICAjbG9vcCBvdmVyIGthbnRvbiBudW1iZXJzIGFuZCBjYWxjdWxhdGUgbXVuaWNpcGFsaXR5IHVyYmFuIGFyZWFzIGFzIGEgJSBvZiBjYW50b24gdXJiYW4gYXJlYQogIGZvcihpIGluIENhbnRvbl91cmJhbl9hcmVhcyRDYW50b25fbnVtKXsKICAKICAjdmVjdG9yIGthbnRvbiB1cmJhbiBhcmVhCiAgQ2FuX3VyYmFuX2FyZWEgPC0gYXMubnVtZXJpYyhDYW50b25fdXJiYW5fYXJlYXNbQ2FudG9uX3VyYmFuX2FyZWFzJENhbnRvbl9udW0gPT0gaSwgImxheWVyIl0pICAKCiAgI3N1YnNldCBtdW5pY2lwYWxpdGllcyB0byB0aGlzIGNhbnRvbiBudW1iZXIgCiAgbXVuaXNfaW5kaWNlcyA8LSB3aGljaChNdW5pX3VyYmFuX2FyZWFzJENhbnRvbl9udW0gPT0gaSkKICAKICAjbG9vcCBvdmVyIG11bmljaXBhbGl0aWVzIGluIHRoZSBLYW50b24gYW5kIGNhbGN1bGF0ZSB0aGVpciB1cmJhbiBhcmVhcyBhcyBhICUgb2YgdGhlIENhbnRvbidzIHRvdGFsICAKICBmb3IobXVuaSBpbiBtdW5pc19pbmRpY2VzKXsKICBNdW5pX3VyYmFuX2FyZWFzJFBlcmNfdXJiYW5bbXVuaV0gPC0gKE11bmlfdXJiYW5fYXJlYXNbbXVuaSwgImxheWVyIl0vQ2FuX3VyYmFuX2FyZWEpKjEwMAogICAgfSAjY2xvc2UgaW5uZXIgbG9vcCAKICB9ICNjbG9zZSBvdXRlciBsb29wCgogICNlc3RpbWF0ZSAlIG9mIHByZWRpY3RlZCBjYW50b25hbCBwb3B1bGF0aW9uIHBlciBtdW5pY2lwYWxpdHkKICAjTG9hZCBsaXN0IG9mIGNhbnRvbmFsIHBvcHVsYXRpb24gbW9kZWxzCiAgcG9wX21vZGVscyA8LSByZWFkUkRTKCJEYXRhL1ByZWRzL1Rvb2xzL0R5bmFtaWNfcG9wX21vZGVscy5yZHMiKQogIAogICNhZGQgcHJlZGljdGVkICUgcG9wIHJlc3VsdHMgY29sdW1uCiAgTXVuaV91cmJhbl9hcmVhcyRQZXJjX3BvcCA8LSAwCiAgCiAgI2VzdGltYXRlICUgb2YgcG9wIHBlciBtdW5pY2lwYWxpdHkKICAjbG9vcCBvdmVyIHVuaXF1ZSBwb2x5Z29uIElEcyByYXRoZXIgdGhhbiBCRlMgbnVtYmVycyB0byB0YWtlIGludG8gYWNjb3VudCB0aGF0CiAgI211bHRpcGxlIHBvbHlnb25zIGhhdmUgdGhlIHNhbWUgQkZTIG51bWJlcgogIGZvcihpIGluIE11bmlfdXJiYW5fYXJlYXMkSUQpewogIAogICNzZXBlcmF0ZSBjYW50b24gc3BlY2lmaWMgbW9kZWwgCiAgY2FudG9uX21vZGVsIDwtIHBvcF9tb2RlbHNbW011bmlfdXJiYW5fYXJlYXNbTXVuaV91cmJhbl9hcmVhcyRJRCA9PSBpLCAiQ2FudG9uX251bSJdXV0KCiAgI3BlcmZvcm0gcHJlZGljdGlvbgogIE11bmlfdXJiYW5fYXJlYXMkUGVyY19wb3BbW2ldXSA8LSBwcmVkaWN0KGNhbnRvbl9tb2RlbCwgbmV3ZGF0YSA9IE11bmlfdXJiYW5fYXJlYXNbTXVuaV91cmJhbl9hcmVhcyRJRCA9PSBpLCBdKSAKICB9CgogICNPdXIgc2NlbmFyaW9zIHJlbHkgb24gc3BlY2lmaWMgcG9wdWxhdGlvbiBwcm9qZWN0cyBmcm9tIEZTTyAoIlJlZiIsICJIaWdoIiwgIkxvdyIpCiAgI0lkZW50aWZ5IHdoaWNoIHBvcHVsYXRpb24gc2NlbmFyaW8gaXMgcmVxdWlyZWQgYWNjb3JkaW5nIHRvIHNjZW5hcmlvIGJlaW5nIHNpbXVsYXRlZAogIFNjZW5hcmlvX2RhdGFfdGFibGUgPC0gb3Blbnhsc3g6OnJlYWQueGxzeCgiVG9vbHMvU2NlbmFyaW9fc3BlY2lmaWNhdGlvbnMueGxzeCIsIHNoZWV0ID0gIlByZWRpY3Rvcl9kYXRhIikKICBQb3Bfc2NlbmFyaW8gPC0gU2NlbmFyaW9fZGF0YV90YWJsZVtTY2VuYXJpb19kYXRhX3RhYmxlJFNjZW5hcmlvX0lEID09IFNjZW5hcmlvX0lELCAiRlNPX3BvcF9zY2VuYXJpbyJdCgogICNsb2FkIGNvcnJlY3Qgc2hlZXQgb2YgZnV0dXJlIHBvcHVsYXRpb24gcHJlZGljdGlvbnMgYWNjb3JkaW5nIHRvIHNjZW5hcmlvCiAgUG9wX3ByZWRpY3Rpb25fdGFibGUgPC0gb3Blbnhsc3g6OnJlYWQueGxzeCgiRGF0YS9QcmVkcy9Ub29scy9Qb3B1bGF0aW9uX3Byb2plY3Rpb25zLnhsc3giLCBzaGVldCA9IFBvcF9zY2VuYXJpbykKCiAgI2xvb3Agb3ZlciB1bmlxdWUga2FudG9uIG51bWJlcnMsIHJlc2NhbGUgdGhlIHByZWRpY3RlZCBwb3B1bGF0aW9uIHBlcmNlbnRhZ2VzCiAgI2FuZCBjYWxjdWxhdGUgdGhlIGVzdGltYXRlZCBwb3B1bGF0aW9uIHBlciBtdW5pY2lwYWxpdHkgYXMgYSAlIG9mIHRoZSBjYW50b25hbCB0b3RhbCAKCiAgI2FkZCByZXN1bHRzIGNvbHVtbgogIE11bmlfdXJiYW5fYXJlYXMkUG9wX2VzdCA8LSAwCgogIGZvcihpIGluIHVuaXF1ZShNdW5pX3VyYmFuX2FyZWFzJENhbnRvbl9udW0pKXsKCiAgICAjc3Vic2V0IHRvIHByZWRpY3RlZCBjYW50b25hbCBwb3B1bGF0aW9uIHBlcmNlbnRhZ2VzCiAgICBDYW50b25fZGF0IDwtIE11bmlfdXJiYW5fYXJlYXNbTXVuaV91cmJhbl9hcmVhcyRDYW50b25fbnVtID09IGksICJQZXJjX3VyYmFuIl0gIAoKICAgICNsb29wIG92ZXIgdGhlIG11bmljaXBhbGl0ZXMgcmUtc2NhbGluZyB0aGUgdmFsdWVzCiAgICBDYW50b25fcHJlZHNfcmVzY2FsZWQgPC0gc2FwcGx5KENhbnRvbl9kYXQsIGZ1bmN0aW9uKHkpIHsKICAgIHZhbHVlIDwtIHkqMS9zdW0oQ2FudG9uX2RhdCkKICAgIHZhbHVlW2lzLm5hKHZhbHVlKV0gPC0gMCAjZGl2aWRpbmcgYnkgWmVybyBpbnRyb2R1Y2VzIE5BJ3Mgc28gdGhlc2UgbXVzdCBiZSBjb252ZXJ0ZWQgYmFjayB0byB6ZXJvCiAgICByZXR1cm4odmFsdWUpfSkgI2Nsb3NlIGlubmVyIGxvb3AKCiAgICAjZ2V0IHRoZSBwcm9qZWN0ZWQgY2FudG9uIHBvcHVsYXRpb24gdmFsdWUgZm9yIHRoaXMgdGltZSBwb2ludAogICAgQ2FudG9uX3BvcCA8LSBQb3BfcHJlZGljdGlvbl90YWJsZVtQb3BfcHJlZGljdGlvbl90YWJsZSRDYW50b25fbnVtID09IGksIHBhc3RlKFNpbXVsYXRpb25fdGltZV9zdGVwKV0KCiAgICAjbG9vcCBvdmVyIHRoZSByZXNjYWxlZCB2YWx1ZXMgY2FsY3VsYXRpbmcgdGhlIGVzdGltYXRlZCBwb3B1bGF0aW9uCiAgICBNdW5pX2luZGljZXMgPC0gd2hpY2goTXVuaV91cmJhbl9hcmVhcyRDYW50b25fbnVtID09IGkpCiAgICBNdW5pX3VyYmFuX2FyZWFzJFBvcF9lc3RbTXVuaV9pbmRpY2VzXSA8LSBzYXBwbHkoQ2FudG9uX3ByZWRzX3Jlc2NhbGVkLCBmdW5jdGlvbih4KSB7CiAgICBwb3BfdmFsdWUgPC0gQ2FudG9uX3BvcCp4ICMlIGFscmVhZHkgZXhwcmVzc2VkIGFzIGRlY2ltYWwgc28gbm8gbmVlZCB0byAvMTAwICAKICAgIH0pICNjbG9zZSBsb29wIG92ZXIgbXVuaWNpcGFsaXRpZXMKCiAgfSAjY2xvc2UgbG9vcCBvdmVyIGNhbnRvbnMKCiAgI2FkZCBlc3RpbWF0ZWQgcG9wdWxhdGlvbiB0byBAZGF0YSB0YWJsZSBvZiBwb2x5Z29ucyBhbmQgdGhlbiByYXN0ZXJpemUKICBNdW5pX3NocEBkYXRhJFBvcF9lc3QgPC0gTXVuaV91cmJhbl9hcmVhcyRQb3BfZXN0CiAgcG9wX3Jhc3RlciA8LSByYXN0ZXI6OnJhc3Rlcml6ZSh4ID0gTXVuaV9zaHAsIHkgPSBSZWZfZ3JpZCwgZmllbGQgPSAiUG9wX2VzdCIsIGJhY2tncm91bmQgPSBOQXZhbHVlKFJlZl9ncmlkKSkKICBuYW1lcyhwb3BfcmFzdGVyKSA8LSAiTXVuaV9wb3AiICNUTyBETzogVEhJUyBNVVNUIEJFIFRIRSBMQVlFUiBOQU1FIElOIFRIRSBDQUxJQlJBVElPTiBTVEFDS1MvTU9ERUxTCiAgCiAgI2NsZWFuIHVwCiAgcm0oQ2FudG9uX3NocCwgQ2FudG9uX3VyYmFuX2FyZWFzLCBDYW5fdXJiYW5fYXJlYSwgY2FudG9uX21vZGVsLCBNdW5pX3NocCwKICAgTXVuaV91cmJhbl9hcmVhcywgbXVuaXNfaW5kaWNlcywgcG9wX21vZGVscywgUG9wX3ByZWRpY3Rpb25fdGFibGUsCiAgIFVyYmFuX3Jhc3QpCgojLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIEUuMi0gRHluYW1pYyBwcmVkaWN0b3JzOiBOZWlnaGJvdXJob29kIHByZWRpY3RvcnMKIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgI2xvYWQgbWF0cmljZXMgdXNlZCB0byBjcmVhdGUgZm9jYWwgbGF5ZXJzCiAgRm9jYWxfbWF0cmljZXMgPC0gdW5saXN0KHJlYWRSRFMoIkRhdGEvUHJlZHMvVG9vbHMvTmVpZ2hib3VyaG9vZF9tYXRyaWNlcy9BTExfbWF0cmljZXMiKSwgcmVjdXJzaXZlID0gRkFMU0UpCgogICNhZGp1c3QgbWF0cml4IG5hbWVzCiAgbmFtZXMoRm9jYWxfbWF0cmljZXMpIDwtIHNhcHBseShuYW1lcyhGb2NhbF9tYXRyaWNlcyksIGZ1bmN0aW9uKHgpIHtzcGxpdF9uYW1lIDwtIChzdHJfc3BsaXQoeCwgIlsuXSIpKVtbMV1dWzJdfSkKCiAgI0xvYWQgZGV0YWlscyBvZiBmb2NhbCBsYXllcnMgcmVxdWlyZWQgZm9yIHRoZSBtb2RlbCBzZXQgYmVpbmcgdXRpbGlzZWQgCiAgUmVxdWlyZWRfZm9jYWxzX2RldGFpbHMgPC0gcmVhZFJEUyhsaXN0LmZpbGVzKCJEYXRhL1ByZWRzL1Rvb2xzL05laWdoYm91cmhvb2RfZGV0YWlsc19mb3JfZHluYW1pY191cGRhdGluZyIsIHBhdHRlcm4gPSBQZXJpb2RfdGFnLCBmdWxsLm5hbWVzID0gVFJVRSkpCgogICNMb29wIG92ZXIgZGV0YWlscyBvZiBmb2NhbCBsYXllcnMgcmVxdWlyZWQgY3JlYXRpbmcgYSBsaXN0IG9mIHJhc3RlcnMgZnJvbSB0aGUgY3VycmVudCBMVUxDIG1hcAogIE5ob29kX3Jhc3RlcnMgPC0gbGlzdCgpCiAgZm9yKGkgaW4gMTpucm93KFJlcXVpcmVkX2ZvY2Fsc19kZXRhaWxzKSl7CiAgCiAgICAjdmVjdG9yIGFjdGl2ZSBjbGFzcyBuYW1lcwogICAgQWN0aXZlX2NsYXNzX25hbWUgPC0gUmVxdWlyZWRfZm9jYWxzX2RldGFpbHNbaSxdJGFjdGl2ZV9sdWxjICAgCiAgCiAgICAjZ2V0IHBpeGVsIHZhbHVlcyBvZiBhY3RpdmUgTFVMQyBjbGFzcwogICAgQWN0aXZlX2NsYXNzX3ZhbHVlIDwtIHVubGlzdChMVUxDX3JhdFtMVUxDX3JhdCRDbGFzc19hYmJyZXZpYXRpb24gPT0gQWN0aXZlX2NsYXNzX25hbWUsICJBZ2dyZWdhdGVkX0lEIl0pCgogICAgI3N1YnNldCBMVUxDIHJhc3RlciBieSBhbGwgQWN0aXZlX2NsYXNzX3ZhbHVlCiAgICBBY3RpdmVfY2xhc3NfcmFzdGVyX3N1YnNldCA8LSBDdXJyZW50X0xVTEMgPT0gQWN0aXZlX2NsYXNzX3ZhbHVlCgogICAgI2NyZWF0ZSBmb2NhbCBsYXllciB1c2luZyBtYXRyaXgKICAgIEZvY2FsX2xheWVyIDwtIGZvY2FsKHg9QWN0aXZlX2NsYXNzX3Jhc3Rlcl9zdWJzZXQsIHc9IEZvY2FsX21hdHJpY2VzW1tSZXF1aXJlZF9mb2NhbHNfZGV0YWlsc1tpLF0kbWF0cml4X2lkXV0sIG5hLnJtPUZBTFNFLCBwYWQ9VFJVRSwgcGFkVmFsdWU9MCwgTkFvbmx5PUZBTFNFKSAKCiAgICAjY3JlYXRlIGZpbGUgcGF0aCBmb3Igc2F2aW5nIHRoaXMgbGF5ZXIgIAogICAgRm9jYWxfbmFtZSA8LSBwYXN0ZShBY3RpdmVfY2xhc3NfbmFtZSwgIm5ob29kIiwgUmVxdWlyZWRfZm9jYWxzX2RldGFpbHNbaSxdJG1hdHJpeF9pZCwgc2VwID0gIl8iKSAKICAgIE5ob29kX3Jhc3RlcnNbW0ZvY2FsX25hbWVdXSA8LSBGb2NhbF9sYXllcgoKICAgICNzdGVwcyBmb3Igc2F2aW5nIG9mIHJhc3RlcnMgaWYgbmVlZGVkCiAgICAjY3JlYXRlIGEgZm9sZGVyIHBhdGggdXNpbmcgc2ltdWxhdGlvbiBJRCBhbmQgdGltZSBzdGVwIAogICAgI0R5bmFtaWNfZm9jYWxfZm9sZGVyX3BhdGggPC0gcGFzdGUwKCJEYXRhL1ByZWRzL1ByZXBhcmVkL1N0YWNrcy9TaW11bGF0aW9uL05IX3ByZWRzIiwgIi8iLCBTY2VuYXJpb19JRCwgIi8iLCBTaW11bGF0aW9uX3RpbWVfc3RlcCkKICAgIAogICAgI2NyZWF0ZSBkaXJlY3RvcnkKICAgICNkaXIuY3JlYXRlKHBhc3RlKHdwYXRoLCBEeW5hbWljX2ZvY2FsX2ZvbGRlcl9wYXRoLCBzZXAgPSAiLyIpLCByZWN1cnNpdmUgPSBUUlVFKQogICAgCiAgICAjRm9jYWxfZmlsZV9uYW1lIDwtIHBhc3RlKFNjZW5hcmlvX0lELCBTaW11bGF0aW9uX3RpbWVfc3RlcCwgUmVxdWlyZWRfZm9jYWxzX2RldGFpbHNbaSxdJGFjdGl2ZV9sdWxjLCAibmhvb2QiLCBGb2NhbF9tYXRyaWNlc1tSZXF1aXJlZF9mb2NhbHNfZGV0YWlsc1tpLF0kbWF0cml4X2lkXSwgc2VwID0gIl8iKQogICAgI0ZvY2FsX2Z1bGxfcGF0aCA8LSBwYXN0ZTAoRHluYW1pY19mb2NhbF9mb2xkZXJfcGF0aCwgIi8iLCBGb2NhbF9maWxlX25hbWUsICIuZ3JkIikgI2NyZWF0ZSBmdWxsIGZvbGRlciBwYXRoCiAgICAjd3JpdGVSYXN0ZXIoRm9jYWxfbGF5ZXIsIEZvY2FsX2Z1bGxfcGF0aCAsZGF0YXR5cGU9J0lOVDJVJywgb3ZlcndyaXRlPVRSVUUpICNzYXZlIGxheWVyCiAgICB9CgogIHJtKEZvY2FsX21hdHJpY2VzLCBGb2NhbF9sYXllciwgRm9jYWxfbmFtZSwgUmVxdWlyZWRfZm9jYWxzX2RldGFpbHMsCiAgIEFjdGl2ZV9jbGFzc19yYXN0ZXJfc3Vic2V0LCBBY3RpdmVfY2xhc3NfbmFtZSwgQWN0aXZlX2NsYXNzX3ZhbHVlKQogIAogIH0gI2Nsb3NlIGlmIHN0YXRlbWVudCBmb3IgZHluYW1pYyBwcmVkaWN0b3IgcHJlcAogIAojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIyMgRi0gQ29tYmluZSBMVUxDLCBTQV9wcmVkcyBhbmQgTmhvb2RfcHJlZHMgYW5kIGV4dHJhY3QgdG8gZGF0YWZyYW1lCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgojU3RhY2sgYWxsIHJhc3RlcnMKI0ZvciBjYWxpYnJhdGlvbiBtb2RlCmlmIChncmVwbCgiY2FsaWJyYXRpb24iLCBNb2RlbF9tb2RlLCBpZ25vcmUuY2FzZSA9IFRSVUUpKXsKVHJhbnNfZGF0YV9zdGFjayA8LSBzdGFjayhMVUxDX2RhdGEsIFNBX3ByZWRfc3RhY2spCm5hbWVzKFRyYW5zX2RhdGFfc3RhY2spIDwtIGMobmFtZXMoTFVMQ19kYXRhKSwgbmFtZXMoU0FfcHJlZF9zdGFja0BsYXllcnMpKQp9ICNjbG9zZSBpZiBzdGF0ZW1lbnQgY2FsaWJyYXRpb24KCiNGb3Igc2ltdWxhdGlvbiBtb2RlCiNvbmx5IHN0YWNrIHRoZSBOaG9vZF9yYXN0ZXJzIGhlcmUgYmVjYXVzZSBvdGhlcndpc2UgdGhleSB3ZXJlIG5vdCBpbmNsdWRlZAojaW4gdGhlIHVwcGVyIHN0YWNrIGZ1bmN0aW9uCmlmIChncmVwbCgic2ltdWxhdGlvbiIsIE1vZGVsX21vZGUsIGlnbm9yZS5jYXNlID0gVFJVRSkpewogIAojbG9hZCB0aGUgcmFzdGVyIG9mIEJpb3JlZ2lvbnMKQmlvcmVnaW9uX3Jhc3QgPC0gcmFzdGVyKCJEYXRhL0Jpb3JlZ19DSC9CaW9yZWdfcmFzdGVyLmdyaSIpCm5hbWVzKEJpb3JlZ2lvbl9yYXN0KSA8LSAiQmlvcmVnaW9uIgpUcmFuc19kYXRhX3N0YWNrIDwtIHN0YWNrKExVTENfZGF0YSwgU0FfcHJlZF9zdGFjaywgcG9wX3Jhc3Rlciwgc3RhY2soTmhvb2RfcmFzdGVycyksIEJpb3JlZ2lvbl9yYXN0KQpuYW1lcyhUcmFuc19kYXRhX3N0YWNrKSA8LSBjKG5hbWVzKExVTENfZGF0YSksIG5hbWVzKFNBX3ByZWRfc3RhY2tAbGF5ZXJzKSwgbmFtZXMocG9wX3Jhc3RlciksIG5hbWVzKE5ob29kX3Jhc3RlcnMpLCBuYW1lcyhCaW9yZWdpb25fcmFzdCkpCn0gI2Nsb3NlIHNpbXVsYXRpb24gaWYgc3RhdGVtZW50CiAgCiNDb252ZXJ0IFJhc3RlcnN0YWNrIHRvIGRhdGFmcmFtZSwgYmVjYXVzZSB0aGUgTFVMQyBhbmQgUmVnaW9uIGxheWVycyBoYXZlIGF0dHJpYnV0ZSB0YWJsZXMgdGhlIGZ1bmN0aW9uIGNyZWF0ZXMgdHdvIGNvbHVtbnMgZm9yIGVhY2g6IFBpeGVsIHZhbHVlIGFuZCBjbGFzcyBuYW1lClRyYW5zX2RhdGFzZXQgPC0gcmFzdGVyOjphcy5kYXRhLmZyYW1lKFRyYW5zX2RhdGFfc3RhY2spIAoKI2FkZCBJRCBjb2x1bW4gdG8gZGF0YXNldAojVHJhbnNfZGF0YXNldCRJRCA8LSBzZXEuaW50KG5yb3coVHJhbnNfZGF0YXNldCkpClRyYW5zX2RhdGFzZXQkSUQgPC0gcm93Lm5hbWVzKFRyYW5zX2RhdGFzZXQpCgojR2V0IFhZIGNvb3JkaW5hdGVzIG9mIGNlbGxzCnh5X2Nvb3JkaW5hdGVzIDwtIGNvb3JkaW5hdGVzKFRyYW5zX2RhdGFfc3RhY2spIAoKI2NiaW5kIFhZIGNvb3JkaW5hdGVzIHRvIGRhdGFmcmFtZSBhbmQgc2VwZXJhdGUgcm93cyB3aGVyZSBhbGwgdmFsdWVzID0gTkEKVHJhbnNfZGF0YXNldCA8LSBjYmluZChUcmFuc19kYXRhc2V0LCB4eV9jb29yZGluYXRlcykgCgojcmVsZWFzZSBtZW1vcnkKcm0oTFVMQ19kYXRhLCBTQV9wcmVkX3N0YWNrLCBOaG9vZF9yYXN0ZXJzLCBUcmFuc19kYXRhX3N0YWNrLCB4eV9jb29yZGluYXRlcykKCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBHLSBSdW4gdHJhbnNpdGlvbiBwb3RlbnRpYWwgcHJlZGljdGlvbiBmb3IgZWFjaCB0cmFuc2l0aW9uCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cgojc2F2ZVJEUyhUcmFuc19kYXRhc2V0LCAiRGF0YS9TcGF0X3Byb2JfcGVydHVyYl9sYXllcnMvRVhQX3RyYW5zX2RhdGFzZXQucmRzIikKI1RyYW5zX2RhdGFzZXQgPC0gcmVhZFJEUygiRGF0YS9TcGF0X3Byb2JfcGVydHVyYl9sYXllcnMvRVhQX3RyYW5zX2RhdGFzZXQucmRzIikKCiNzdWJzZXR0aW5nIGRhdGEgaW5kaWNlcyBmb3IgZ2xhY2lhbCBtb2RlbGxpbmcKI2RhdGFfaW5kaWNlcyA8LSBUcmFuc19kYXRhc2V0WyxjKCJJRCIsICJ4IiwgInkiKV0KI3dyaXRlLmNzdihkYXRhX2luZGljZXMsICJEYXRhL0RhdGFfaW5kaWNlc19mdWxsLmNzdiIsIHJvdy5uYW1lcyA9IEZBTFNFKQojd3JpdGUudGFibGUoZGF0YV9pbmRpY2VzLCAiRGF0YS9EYXRhX2luZGljZXNfZnVsbC50eHQiLCByb3cubmFtZXMgPSBGQUxTRSkKCiNsb2FkIG1vZGVsIGxvb2sgdXAKTW9kZWxfbG9va3VwIDwtIHhsc3g6OnJlYWQueGxzeCgiVG9vbHMvTW9kZWxfbG9va3VwLnhsc3giLCBzaGVldE5hbWUgPSBQZXJpb2RfdGFnKQoKI2lmIHN0YXRlbWVudCB0byByZW1vdmUgdHJhbnNpdGlvbnMgaWYgdGhleSBhcmUgYmVpbmcgaW1wbGVtZW50ZWQgZGV0ZXJtaW5pc3RpY2FsbHkKaWYoZ3JlcGwoInNpbXVsYXRpb24iLCBNb2RlbF9tb2RlLCBpZ25vcmUuY2FzZSA9IFRSVUUpICYKICAgIGdyZXBsKCJZIiwgU2ltdWxhdGlvbl90YWJsZSREZXRlcm1pbmlzdGljX3RyYW5zLnN0cmluZywgaWdub3JlLmNhc2UgPSBUUlVFKSl7CgogICNyZW1vdmUgdHJhbnNpdGlvbnMgd2l0aCBpbml0aWFsIGNsYXNzID09IGdsYWNpZXIKICBNb2RlbF9sb29rdXAgPC1Nb2RlbF9sb29rdXBbTW9kZWxfbG9va3VwJEluaXRpYWxfTFVMQyAhPSAiR2xhY2llciIsXQoKICB9ICNjbG9zZSBpZiBzdGF0ZW1lbnQKCiNzZXBlcmF0ZSBUcmFuc19kYXRhc2V0IGludG8gY29tcGxldGUgY2FzZXMgZm9yIHByZWRpY3Rpb24KI2FuZCBOQXMgKCliYWNrZ3JvdW5kIHZhbHVlcwpUcmFuc19kYXRhc2V0X2NvbXBsZXRlIDwtIFRyYW5zX2RhdGFzZXQgJT4lCiAgZmlsdGVyKGNvbXBsZXRlLmNhc2VzKC4pKQpyb3cubmFtZXMoVHJhbnNfZGF0YXNldF9jb21wbGV0ZSkgPC0gVHJhbnNfZGF0YXNldF9jb21wbGV0ZSRJRAoKVHJhbnNfZGF0YXNldF9uYSA8LSBUcmFuc19kYXRhc2V0ICU+JQogIGZpbHRlcighY29tcGxldGUuY2FzZXMoLikpICAKVHJhbnNfZGF0YXNldF9uYSA8LSBUcmFuc19kYXRhc2V0X25hWywgYygiSUQiLCAieCIsICJ5IildCnJvdy5uYW1lcyhUcmFuc19kYXRhc2V0X25hKSA8LSBUcmFuc19kYXRhc2V0X25hJElECgpybShUcmFuc19kYXRhc2V0KQoKI3NlcGVyYXRlIElELCB4L3kgYW5kIEluaXRpYWxfTFVMQyBjb2xzIHRvIGFwcGVuZCByZXN1bHRzIHRvClByZWRpY3Rpb25fcHJvYnMgPC0gVHJhbnNfZGF0YXNldF9jb21wbGV0ZVssIGMoIklEIiwgIngiLCAieSIsIHVuaXF1ZShNb2RlbF9sb29rdXAkSW5pdGlhbF9MVUxDKSwgIlN0YXRpYyIpXQpyb3cubmFtZXMoUHJlZGljdGlvbl9wcm9icykgPC0gUHJlZGljdGlvbl9wcm9icyRJRAoKI2FkZCBjb2xzIHRvIGJvdGggdGhlIGNvbXBsZXRlIGFuZCBOQSBkYXRhIHRvIGNhcHR1cmUgcHJlZGljdCBwcm9iYWJpbGl0aWVzIHRvIGVhY2ggY2xhc3MKRmluYWxfTFVMQ19jbGFzc2VzIDwtIHVuaXF1ZShNb2RlbF9sb29rdXAkRmluYWxfTFVMQykKZm9yKGkgaW4gRmluYWxfTFVMQ19jbGFzc2VzKXsKUHJlZGljdGlvbl9wcm9ic1tbcGFzdGUwKCJQcm9iXyIsIGkpXV0gPC0gMApUcmFuc19kYXRhc2V0X25hW1twYXN0ZTAoIlByb2JfIiwgaSldXSA8LSBOQQp9CgppZihVc2VfcGFyYWxsZWwgPT0gIlkiKXsKClBhcl9zdGFydF90aW1lIDwtIFN5cy50aW1lKCkgIAojc2V0IHVwIGNsdXN0ZXIgZm9yIHBhcmFsbGVsIGNvbXB1dGF0aW9uCnBsYW4oZnV0dXJlLmNhbGxyOjpjYWxsciwgd29ya2Vycz1hdmFpbGFibGVDb3JlcyhvbWl0ID0gMikpCgpzaXplID0gNTAwMCoxMDI0XjIgCm9wdGlvbnMoZnV0dXJlLmdsb2JhbHMubWF4U2l6ZT0gc2l6ZSkKCiNsb29wIG92ZXIgdHJhbnNpdGlvbnMgKGN1cnJlbnRseSB0YWtlcyA0IG1pbnMgaW4gcGFyYWxsZWwpCnJlc3VsdHMgPC0gZnV0dXJlLmFwcGx5OjpmdXR1cmVfbGFwcGx5KDE6bnJvdyhNb2RlbF9sb29rdXApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdXR1cmUucGFja2FnZXMgPSBwYWNrcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oaSl7CgojZ2MoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAojdmVjdG9yIHRyYW5zX25hbWUKVHJhbnNfbmFtZSA8LSBNb2RlbF9sb29rdXBbaSwgIlRyYW5zX25hbWUiXQpUcmFuc19JRCA8LSBNb2RlbF9sb29rdXBbaSwgIlRyYW5zX0lEIl0KUmVnaW9uIDwtIE1vZGVsX2xvb2t1cFtpLCJSZWdpb24iXQpGaW5hbF9MVUxDIDwtIE1vZGVsX2xvb2t1cFtpLCAiRmluYWxfTFVMQyJdCkluaXRpYWxfTFVMQyA8LSBNb2RlbF9sb29rdXBbaSwgIkluaXRpYWxfTFVMQyJdCgojbG9hZCBtb2RlbApGaXR0ZWRfbW9kZWwgPC0gcmVhZFJEUyhNb2RlbF9sb29rdXBbaSwgIkZpbGVfcGF0aCJdKQoKI3N1YnNldCBkYXRhIGZvciBwcmVkaWN0aW9uCnByZWRfZGF0YSA8LSBUcmFuc19kYXRhc2V0X2NvbXBsZXRlW1RyYW5zX2RhdGFzZXRfY29tcGxldGVbSW5pdGlhbF9MVUxDXSA9PSAxICYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmFuc19kYXRhc2V0X2NvbXBsZXRlJEJpb3JlZ2lvbl9DbGFzc19OYW1lcyA9PSBSZWdpb24sXSAKCiNwcmVkaWN0IHVzaW5nIGZpdHRlZCBtb2RlbApwcm9iX3ByZWRpY3RzIDwtIGFzLmRhdGEuZnJhbWUocHJlZGljdChGaXR0ZWRfbW9kZWwsIHByZWRfZGF0YSwgdHlwZT0icHJvYiIpKQpuYW1lcyhwcm9iX3ByZWRpY3RzKVtbMl1dIDwtIHBhc3RlMCgiUHJvYl8iLCBGaW5hbF9MVUxDKQoKI2JpbmQgdG8gSUQKcHJlZGljdF9JRCA8LSBjYmluZChJRCA9IHByZWRfZGF0YVssIGMoIklEIildLCBwcm9iX3ByZWRpY3RzW3Bhc3RlMCgiUHJvYl8iLCBGaW5hbF9MVUxDKV0pCgojZ2MoKQojcmV0dXJuIHRoZSBwcmVkaWN0aW9uIHJlc3VsdHMgdG8gYmUgYm91bmQgdG9nZXRoZXIKcmV0dXJuKHByZWRpY3RfSUQpCn0pICNjbG9zZSBsb29wIG92ZXIgTW9kZWxzCnBsYW4oc2VxdWVudGlhbCkKCiNOb3cgdGhlIHJlc3VsdHMgbmVlZCB0byBiZSBjb21iaW5lZCB3aXRoIG90aGVyIHJvd3MKI3Jlc3VsdHMgYXJlIGJlaW5nIHJldHVybmVkIGFzIGEgbGlzdApmb3IoaSBpbiByZXN1bHRzKXsKCiNnZXQgUHJvYl9MVUxDIGNvbHVtbiBuYW1lIHRvIG1ha2UgYXBwZW5kaW5nIHNpbXBsZXIKTFVMQ19jb2xfbmFtZSA8LSBjb2xuYW1lcyhpKVsyXQoKI0FwcGVuZCBwcmVkaWN0aW9uIHJlc3VsdHMgICAKUHJlZGljdGlvbl9wcm9ic1t3aGljaChQcmVkaWN0aW9uX3Byb2JzJElEICVpbiUgaVtbIklEIl1dKSwgTFVMQ19jb2xfbmFtZV0gPC0gaVtbTFVMQ19jb2xfbmFtZV1dCn0KUGFyX2VuZF90aW1lIDwtIFN5cy50aW1lKCkKUGFyX3RpbWUgPC0gUGFyX2VuZF90aW1lIC0gUGFyX3N0YXJ0X3RpbWUgICMgUGFyYWxsZWwgdGltZSA9IDEuNDcyODU5IG1pbnMKCn1lbHNlIGlmIChVc2VfcGFyYWxsZWwgPT0gIk4iKXsgI2Nsb3NlIHBhcmFsbGVsIFRQQyBjaHVuawoKI05vbl9wYXJhbGxlbCBUUEMgY2FsY3VsYXRpb246IApOb25fcGFyX3N0YXJ0IDwtIFN5cy50aW1lKCkgCiNsb29wIG92ZXIgdHJhbnNpdGlvbnMKZm9yKGkgaW4gMTpucm93KE1vZGVsX2xvb2t1cCkpewoKI3ZlY3RvciB0cmFuc19uYW1lClRyYW5zX25hbWUgPC0gTW9kZWxfbG9va3VwW2ksICJUcmFuc19uYW1lIl0KVHJhbnNfSUQgPC0gTW9kZWxfbG9va3VwW2ksICJUcmFuc19JRCJdClJlZ2lvbiA8LSBNb2RlbF9sb29rdXBbaSwiUmVnaW9uIl0KRmluYWxfTFVMQyA8LSBNb2RlbF9sb29rdXBbaSwgIkZpbmFsX0xVTEMiXQpJbml0aWFsX0xVTEMgPC0gTW9kZWxfbG9va3VwW2ksICJJbml0aWFsX0xVTEMiXQoKI3ByaW50IHN0YXR1cyBtZXNzYWdlCmNhdChwYXN0ZTAoInByZWRpY3RpbmcgcHJvYmFiaWxpdGllcyBmb3IgdHJhbnNpdGlvbnMgZnJvbSAiLCBJbml0aWFsX0xVTEMsICIgdG8gIiwgRmluYWxfTFVMQywgIiB3aXRoaW4gcmVnaW9uOiAiLCBSZWdpb24sICJcbiIpKQoKI2xvYWQgbW9kZWwKRml0dGVkX21vZGVsIDwtIHJlYWRSRFMoTW9kZWxfbG9va3VwW2ksICJGaWxlX3BhdGgiXSkKCiNzdWJzZXQgZGF0YSBmb3IgcHJlZGljdGlvbgpwcmVkX2RhdGEgPC0gVHJhbnNfZGF0YXNldF9jb21wbGV0ZVtUcmFuc19kYXRhc2V0X2NvbXBsZXRlW0luaXRpYWxfTFVMQ10gPT0gMSAmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJhbnNfZGF0YXNldF9jb21wbGV0ZSRCaW9yZWdpb25fQ2xhc3NfTmFtZXMgPT0gUmVnaW9uLF0gCgojcHJlZGljdCB1c2luZyBmaXR0ZWQgbW9kZWwKcHJvYl9wcmVkaWN0cyA8LSBhcy5kYXRhLmZyYW1lKHByZWRpY3QoRml0dGVkX21vZGVsLCBwcmVkX2RhdGEsIHR5cGU9InByb2IiKSkKbmFtZXMocHJvYl9wcmVkaWN0cylbWzJdXSA8LSBwYXN0ZTAoIlByb2JfIiwgRmluYWxfTFVMQykKCiNiaW5kIHRvIElECiNwcmVkaWN0X0lEIDwtIGNiaW5kKElEID0gcHJlZF9kYXRhWywgYygiSUQiKV0sIHByb2JfcHJlZGljdHNbcGFzdGUwKCJQcm9iXyIsIEZpbmFsX0xVTEMpXSkKCiNhcHBlbmQgdGhlIHByZWRpY3Rpb25zIGF0IHRoZSBjb3JyZWN0IHJvd3MgaW4gdGhlIHJlc3VsdHMgZGYKI1ByZWRpY3Rpb25fcHJvYnNbd2hpY2goUHJlZGljdGlvbl9wcm9icyRJRCAlaW4lIHByZWRpY3RfSUQkSUQpLCBwYXN0ZTAoIlByb2JfIiwgRmluYWxfTFVMQyldIDwtIHByZWRpY3RfSURbcGFzdGUwKCJQcm9iXyIsIEZpbmFsX0xVTEMpXQoKI2FsdGVybmF0aXZlIG1ldGhvZCBvZiByZXBsYWNpbmcgcHJvYiBwcmVkaWN0aW9uIHZhbHVlcwpQcmVkaWN0aW9uX3Byb2JzW3Jvdy5uYW1lcyhwcm9iX3ByZWRpY3RzKSxwYXN0ZTAoIlByb2JfIiwgRmluYWxfTFVMQyldIDwtIHByb2JfcHJlZGljdHNbcGFzdGUwKCJQcm9iXyIsIEZpbmFsX0xVTEMpXQoKfSAjY2xvc2UgbG9vcCBvdmVyIE1vZGVscwpOb25fcGFyX2VuZCA8LSBTeXMudGltZSgpCk5vbl9wYXJfdGltZSA8LSBOb25fcGFyX2VuZCAtIE5vbl9wYXJfc3RhcnQgI3NlcXVlbnRpYWwgdGltZSA9IDIuOTM3MTMxIG1pbnMKICB9ICNDbG9zZSBub24tcGFyYWxsZWwgVFBDIGNodW5rIAoKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyMjIEctIFJlLXNjYWxlIHByZWRpY3Rpb25zCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgojbG9vcCBvdmVyIHJvd3MgYW5kIHJlLXNjYWxlIHByb2JhYmlsaXR5IHZhbHVlcyBzbyB0aGF0IHRoZXkgc3VtIHRvIDEKIyhieSBkaXZpZGluZyBieSBtdWx0aXBseWluZyBieSAxIGFuZCB0aGVuIGRpdmlkaW5nIGJ5IHRoZSBzdW0gb2YgdGhlIHZlY3RvcikKCiNUcmFuc2l0aW9uIHByb2JhYmlsaXR5IGNvbHVtbnMgdG8gcmUtc2NhbGUKUHJlZF9wcm9iX2NvbHVtbnMgPC0gZ3JlcCgiUHJvYl8iLCBuYW1lcyhQcmVkaWN0aW9uX3Byb2JzKSwgdmFsdWUgPSBUUlVFKQoKI3ZlY3RvciByb3cgaW5kaWNlcyB3aXRoIG5vbi16ZXJvIHN1bXMgb2YgdHJhbnNpdGlvbiBwcm9iYWJpbGl0aWVzCk5vbl96ZXJvX2luZGljZXMgPC0gd2hpY2gocm93U3VtcyhQcmVkaWN0aW9uX3Byb2JzWyxQcmVkX3Byb2JfY29sdW1uc10pID4xKQoKI0xvb3Agb3ZlciByb3dzIHBlcmZvcm1pbmcgcmUtc2NhbGluZwpQcmVkaWN0aW9uX3Byb2JzW05vbl96ZXJvX2luZGljZXMgLFByZWRfcHJvYl9jb2x1bW5zXSA8LSBhcy5kYXRhLmZyYW1lKHQoYXBwbHkoUHJlZGljdGlvbl9wcm9ic1tOb25femVyb19pbmRpY2VzLFByZWRfcHJvYl9jb2x1bW5zXSwgTUFSR0lOID0gMSwgRlVOID0gZnVuY3Rpb24oeCkgewpzYXBwbHkoeCwgZnVuY3Rpb24oeSkgewp2YWx1ZSA8LSB5KjEvc3VtKHgpCnZhbHVlW2lzLm5hKHZhbHVlKV0gPC0gMCAjZGl2aWRpbmcgYnkgWmVybyBpbnRyb2R1Y2VzIE5BJ3Mgc28gdGhlc2UgbXVzdCBiZSBjb252ZXJ0ZWQgYmFjayB0byB6ZXJvCnJldHVybih2YWx1ZSkKfSkKfSkpKQoKI2JpbmQgd2l0aCBiYWNrZ3JvdW5kIHZhbHVlcwpUcmFuc19kYXRhc2V0X25hW3NldGRpZmYobmFtZXMoUHJlZGljdGlvbl9wcm9icyksIG5hbWVzKFRyYW5zX2RhdGFzZXRfbmEpKV0gPC0gTkEKUmFzdGVyX3Byb2JfdmFsdWVzIDwtIHJiaW5kKFByZWRpY3Rpb25fcHJvYnMsIFRyYW5zX2RhdGFzZXRfbmEpCgojc29ydCBieSBJRApSYXN0ZXJfcHJvYl92YWx1ZXMgPC0gUmFzdGVyX3Byb2JfdmFsdWVzW29yZGVyKGFzLm51bWVyaWMocm93Lm5hbWVzKFJhc3Rlcl9wcm9iX3ZhbHVlcykpKSwgXQoKI1NhdmUgb25lIGNvcHkgb2YgdGhlIHJhc3RlciBwcm9iYWJpbGl0eSB2YWx1ZXMgdG8gYmUgdXNlZCB0byB0ZXN0CiNzcGF0aWFsIGludGVydmVudGlvbnMsIHRoaXMgZmlsZSB3aWxsIGJlIGNyZWF0ZWQgZHVyaW5nIHRoZSBydW5uaW5nIG9mIHRoZSBtb2RlbAojdG8gY2FsaWJyYXRlIHRoZSBEaW5hbWljYSBhbGxvY2F0aW9uIHBhcmFtZXRlcnMuCmlmKGZpbGUuZXhpc3RzKCJEYXRhL0V4ZW1wbGFyX2RhdGEvRVhQX3Jhc3Rlcl9wcm9iX3ZhbHVlcy5yZHMiKSA9PSBGQUxTRSl7CiAgICBkaXIuY3JlYXRlKCJEYXRhL0V4ZW1wbGFyX2RhdGEiKQogICAgc2F2ZVJEUyhSYXN0ZXJfcHJvYl92YWx1ZXMsICJEYXRhL0V4ZW1wbGFyX2RhdGEvRVhQX3Jhc3Rlcl9wcm9iX3ZhbHVlcy5yZHMiKQogIH0KCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMjIyBILSBTcGF0aWFsIG1hbmlwdWxhdGlvbnMgb2YgdHJhbnNpdGlvbiBwcm9iYWJpbGl0aWVzCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgppZiAoZ3JlcGwoInNpbXVsYXRpb24iLCBNb2RlbF9tb2RlLCBpZ25vcmUuY2FzZSA9IFRSVUUpKXsKICAKICAjSWYgc3RhdGVtZW50IHRvIGltcGxlbWVudCBzcGF0aWFsIGludGVydmVudGlvbnMKICBpZihVc2VfaW50ZXJ2ZW50aW9ucyA9PSAiWSIpewogICAgCiAgI2xvYWQgdGFibGUgb2Ygc2NlbmFyaW8gaW50ZXJ2ZW50aW9ucwogIEludGVydmVudGlvbnMgPC0gb3Blbnhsc3g6OnJlYWQueGxzeChTY2VuYXJpb19zcGVjc19wYXRoLCBzaGVldCA9ICJJbnRlcnZlbnRpb25zIikgIAogICAgCiAgI1VzZSBmdW5jdGlvbiB0byBwZXJmb3JtIG1hbmlwdWxhdGlvbiBvZiBzcGF0aWFsIHRyYW5zaXRpb24gcHJvYmFiaWxpdGllcwogICNhY2NvcmRpbmcgdG8gc2NlbmFyaW8tc3BlY2lmaWMgaW50ZXJ2ZW50aW9ucyAKICBSYXN0ZXJfcHJvYl92YWx1ZXMgPC0gbHVsY2Muc3BhdHByb2JtYW5pcHVsYXRpb24oSW50ZXJ2ZW50aW9ucyA9IEludGVydmVudGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2NlbmFyaW9fSUQgPSBTY2VuYXJpb19JRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSYXN0ZXJfcHJvYl92YWx1ZXMgPSBSYXN0ZXJfcHJvYl92YWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2ltdWxhdGlvbl90aW1lX3N0ZXAgPSBwYXN0ZShTaW11bGF0aW9uX3RpbWVfc3RlcCkpCiAgfSAjY2xvc2UgaWYgc3RhdGVtZW50IGZvciBzcGF0aWFsIGludGVydmVudGlvbnMKCn0gI2Nsb3NlIHNpbXVsYXRpb24gaWYgc3RhdGVtZW50CgojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIyMgSS0gRmluYWwgcmVzY2FsaW5nCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgojdmVjdG9yIHJvdyBpbmRpY2VzIHdpdGggbm9uLXplcm8gc3VtcyBvZiB0cmFuc2l0aW9uIHByb2JhYmlsaXRpZXMKTm9uX3plcm9faW5kaWNlcyA8LSB3aGljaChyb3dTdW1zKFJhc3Rlcl9wcm9iX3ZhbHVlc1ssUHJlZF9wcm9iX2NvbHVtbnNdKSA+IDEpCgojTG9vcCBvdmVyIHJvd3MgcGVyZm9ybWluZyByZS1zY2FsaW5nClJhc3Rlcl9wcm9iX3ZhbHVlc1tOb25femVyb19pbmRpY2VzICxQcmVkX3Byb2JfY29sdW1uc10gPC0gYXMuZGF0YS5mcmFtZSh0KGFwcGx5KFJhc3Rlcl9wcm9iX3ZhbHVlc1tOb25femVyb19pbmRpY2VzLFByZWRfcHJvYl9jb2x1bW5zXSwgTUFSR0lOID0gMSwgRlVOID0gZnVuY3Rpb24oeCkgewpzYXBwbHkoeCwgZnVuY3Rpb24oeSkgewp2YWx1ZSA8LSB5KjEvc3VtKHgpCnZhbHVlW2lzLm5hKHZhbHVlKV0gPC0gMCAjZGl2aWRpbmcgYnkgWmVybyBpbnRyb2R1Y2VzIE5BJ3Mgc28gdGhlc2UgbXVzdCBiZSBjb252ZXJ0ZWQgYmFjayB0byB6ZXJvCnJldHVybih2YWx1ZSkKfSkKfSkpKQoKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyMjIEotIFNhdmUgdHJhbnNpdGlvbiByYXN0ZXJzCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cgojc3Vic2V0IG1vZGVsX2xvb2t1cCB0YWJsZSB0byB1bmlxdWUgdHJhbnMgSUQKVW5pcXVlX3RyYW5zIDwtIE1vZGVsX2xvb2t1cFshZHVwbGljYXRlZChNb2RlbF9sb29rdXAkVHJhbnNfSUQpLCBdCgojTG9vcCBvdmVyIHVuaXF1ZSB0cmFucyB1c2luZyBkZXRhaWxzIHRvIHN1YnNldCBkYXRhIGFuZCBzYXZlIFJhc3RlcnMKZm9yKGkgaW4gMTpucm93KFVuaXF1ZV90cmFucykpewoKVHJhbnNfSUQgPC0gVW5pcXVlX3RyYW5zW2ksICJUcmFuc19JRCJdCkZpbmFsX0xVTEMgPC0gVW5pcXVlX3RyYW5zW2ksICJGaW5hbF9MVUxDIl0KSW5pdGlhbF9MVUxDIDwtIFVuaXF1ZV90cmFuc1tpLCAiSW5pdGlhbF9MVUxDIl0KCiNnZXQgaW5kaWNlcyBvZiByb3dzIGZvciBjZWxscyBvZiBpbml0aWFsIGNsYXNzCkluaXRpYWxfaW5kaWNlcyA8LSBuYS5vbWl0KFJhc3Rlcl9wcm9iX3ZhbHVlc1tSYXN0ZXJfcHJvYl92YWx1ZXNbSW5pdGlhbF9MVUxDXSA9PSAxLCJJRCJdKQoKI2dldCBpbmRpY2VzIG9mIG5vbl9jbGFzcyBjZWxscwpub25faW5pdGlhbF9pbmRpY2VzIDwtIG5hLm9taXQoUmFzdGVyX3Byb2JfdmFsdWVzW1Jhc3Rlcl9wcm9iX3ZhbHVlc1tJbml0aWFsX0xVTENdID09IDAsIklEIl0pCgojc2VwZXJhdGUgRmluYWwgY2xhc3MgY29sdW1uClRyYW5zX3Jhc3Rlcl92YWx1ZXMgPC0gUmFzdGVyX3Byb2JfdmFsdWVzWywgYygiSUQiLCAieCIsICJ5IiwgcGFzdGUwKCJQcm9iXyIsIEZpbmFsX0xVTEMpKV0KCiNyZXBsYWNlIHZhbHVlcyBvZiBub24tY2xhc3MgY2VsbHMgd2l0aCAwClRyYW5zX3Jhc3Rlcl92YWx1ZXNbbm9uX2luaXRpYWxfaW5kaWNlcywgcGFzdGUwKCJQcm9iXyIsIEZpbmFsX0xVTEMpXSA8LSAwCgojcmFzdGVyaXplIGFuZCBzYXZlIHVzaW5nIEluaXRpYWwgYW5kIEZpbmFsIGNsYXNzIG5hbWVzClByb2JfcmFzdGVyIDwtIHJhc3RlckZyb21YWVooVHJhbnNfcmFzdGVyX3ZhbHVlc1ssYygieCIsICJ5IiwgcGFzdGUwKCJQcm9iXyIsIEZpbmFsX0xVTEMpKV0sIGNycyA9IGNycyhDdXJyZW50X0xVTEMpKQoKI3ZlY3RvciBmaWxlIHBhdGggZm9yIHNhdmluZyBwcm9iYWJpbGl0eSBtYXBzCnByb2JfbWFwX3BhdGggPC0gcGFzdGUwKHByb2JfbWFwX2ZvbGRlciwgIi8iLCBUcmFuc19JRCwgIl9wcm9iYWJpbGl0eV8iLCBJbml0aWFsX0xVTEMsICJfdG9fIiwgRmluYWxfTFVMQywgIi50aWYiKQoKd3JpdGVSYXN0ZXIoUHJvYl9yYXN0ZXIsIHByb2JfbWFwX3BhdGgsIG92ZXJ3cml0ZT1UKQp9ICNjbG9zZSBsb29wIG92ZXIgdHJhbnNpdGlvbnMgCgojUmV0dXJuIHRoZSBwcm9iYWJpbGl0eSBtYXAgZm9sZGVyIHBhdGggYXMgYSBzdHJpbmcgdG8KI0RpbmFtaWNhIHRvIGluZGljYXRlIGNvbXBsZXRpb24KI05vdGUgc3RyaW5ncyBtdXN0IGJlIHZlY3Rvcml6ZWQgZm9yICdvdXRwdXRTdHJpbmcgdG8gd29yawpvdXRwdXRTdHJpbmcoInByb2JtYXBfZm9sZGVyX3BhdGgiLCBwcm9iX21hcF9mb2xkZXIp" .no {{
                            @alias = Control table path
                            NumberString specifyControlTableFilePathTableConsistingOfColumnsSpecifyingTheSimulationsToBePerformedEGScenariosLengthVersionsEtc 1;

                            @alias = File path for simulated LULC maps
                            NumberString receiveFilePathForSimulatedLulcMaps 2;

                            @alias = Working directory
                            NumberString specifyWorkingDirectoryFromR 3;

                            @alias = Time_step
                            NumberValue timeStep 1;

                            //
                            // ===
                            // Row of current simulation in table 
                            @alias = Current simulation number
                            NumberValue simulationNumber 2;
                        }};

                        @viewer.string = yes
                        folderPathForProbabilityMaps := ExtractStructString transitionPotentialRScript $"(probmap_folder_path)";

                        @viewer.probabilityMapsRasterCube = yes
                        createCubeOfProbabilityMaps2989 := CreateCubeOfProbabilityMaps transitionRatesTable folderPathForProbabilityMaps;
                    }};

                    @alias = Transition allocation
                    _ := Group .none {{
                        @collapsed = no
                        createSimulatedLulcSavePath := CalculateRExpression "IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMgRGluYW1pY2FfbW9kaWZ5X2x1bGNfc2F2ZV9wYXRoOiBGaW5hbGl6ZSBzYXZlIHBhdGggZm9yIHNpbXVsYXRlZCBMVUxDIG1hcAojIyBhY2NvcmRpbmcgdG8gdGltZSBzdGVwCiMjIERhdGU6IDEwLTEwLTIwMjIKIyMgQXV0aG9yOiBCZW4gQmxhY2sKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiNyZWNlaXZlIGJhc2ljIHBhdGggZnJvbSBEaW5hbWljYSAocHJvZHVjZWQgYnkgc2NyaXB0IERpbmFtaWNhX2luaXRpYWxpemUpCkxVTENfYmFzZV9wYXRoIDwtIHMxCgojcmVjZWl2ZSB0aW1lIHN0ZXAKVGltZV9zdGVwIDwtIHYxClN0ZXBfbGVuZ3RoIDwtIHYyIAoKI2FkZCBzdGVwIGxlbmd0aCB0byBjdXJyZW50IHRpbWUgc3RlcCB0byBnZXQgc2ltdWxhdGlvbiB5ZWFyClNpbXVsYXRlZF9sdWxjX3llYXIgPC0gIHBhc3RlKChUaW1lX3N0ZXAgKyBTdGVwX2xlbmd0aCkpCgojcGFzdGUgdG9nZXRoZXIgYW5kIGluY2x1ZGUgJy50aWYnIGFzIHRoZSBmaWxlIHR5cGUKRmluYWxfbFVMQ19wYXRoIDwtIHBhc3RlMChMVUxDX2Jhc2VfcGF0aCwgU2ltdWxhdGVkX2x1bGNfeWVhciwgIi50aWYiKQoKI091dHB1dCB0aGUgcGF0aApvdXRwdXRTdHJpbmcoInNpbXVsYXRlZF9sdWxjX3NhdmVfcGF0aCIsIEZpbmFsX2xVTENfcGF0aCkKCiNvdXRwdXQgdGhlIHNpbXVsYXRlZCBtYXAgeWVhciBmb3IgdXNlIGluIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBkZXRlcm1pbmlzdGljIHRyYW5zaXRpb25zCm91dHB1dFN0cmluZygiU2ltdWxhdGVkX0xVTENfeWVhciIsIFNpbXVsYXRlZF9sdWxjX3llYXIpCg==" .no {{
                            @alias = Simulated LULC map base path
                            NumberString receiveFilePathForSimulatedLulcMaps 1;

                            @alias = Current time
                            NumberValue timeStep 1;

                            @alias = Model step length
                            NumberValue stepLength 2;
                        }};

                        @viewer.resultingLanscape = yes
                        allocateTransitions1203 := AllocateTransitions {
                            lanscape = updatedLulcMap,
                            probabilities = createCubeOfProbabilityMaps2989,
                            transitionMatrix = transitionRatesTable,
                            percentOfTransitionsByExpansion = expansionTable,
                            patchExpansionParameters = patchRelatedParams,
                            patchGenerationParameters = patchRelatedParams,
                            printTransitionInfo = .yes
                        };

                        @viewer.string = yes
                        simulatedLulcSavePath := ExtractStructString createSimulatedLulcSavePath $"(simulated_lulc_save_path)";

                        // Simulated LULC map saved at every time step. Receives time info from control 
                        // operator and adds a suffix to the file path. 
                        @alias = Save simulated LULC
                        SaveMap {
                            map = allocateTransitions1203,
                            filename = simulatedLulcSavePath,
                            suffixDigits = 0,
                            step = 0,
                            useCompression = .yes,
                            workdir = workdir,
                            ignoreCostlySparseCategories = .yes
                        };

                        simulatedLulcYear := ExtractStructString createSimulatedLulcSavePath $"(Simulated_LULC_year)";
                    }};

                    @alias = Implement deterministic transitions
                    _ := Group .none {{
                        @collapsed = no
                        deterministicTransitions := CalculateRExpression "IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMgRGluYW1pY2FfZGV0ZXJtaW5pc3RpY190cmFuczogSW1wbGVtZW50IGRldGVybWluaXN0aWMgdHJhbnNpdGlvbnMgCiMjIGZvbGxvd2luZyBzdGF0aXN0aWNhbCB0cmFuc2l0aW9uIHBvdGVudGlhbCBkdXJpbmcgZHVyaW5nIHNpbXVsYXRpb24gc3RlcAojIyBEYXRlOiAwMy0wNS0yMDIzCiMjIEF1dGhvcjogQmVuIEJsYWNrCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIyMgQS0gUHJlcGFyYXRpb24KIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiNyZWNlaXZlIHdvcmtpbmcgZGlyZWN0b3J5CndwYXRoIDwtIHMyCiN3cGF0aCA8LSBnZXR3ZCgpCnNldHdkKHdwYXRoKQoKI1ZlY3RvciBwYWNrYWdlcyBmb3IgbG9hZGluZwpwYWNrczwtYygiZGF0YS50YWJsZSIsICJyYXN0ZXIiLCAidGlkeXZlcnNlIiwic3RyaW5nciIsICJyZWFkciIsICJ4bHN4IiwKICAgICAgICAgIkRpbmFtaWNhIiwgInJlYWR4bCIpCgpuZXcucGFja3M8LXBhY2tzWyEocGFja3MgJWluJSBpbnN0YWxsZWQucGFja2FnZXMoKVssIlBhY2thZ2UiXSldCmlmKGxlbmd0aChuZXcucGFja3MpKSBpbnN0YWxsLnBhY2thZ2VzKG5ldy5wYWNrcykKCiMgTG9hZCByZXF1aXJlZCBwYWNrYWdlcwppbnZpc2libGUobGFwcGx5KHBhY2tzLCByZXF1aXJlLCBjaGFyYWN0ZXIub25seSA9IFRSVUUpKQoKI3NlbmQgbW9kZWwgdG9vbCB2YXJzIHRvIGdsb2JhbCBlbnZpcm9ubWVudApsaXN0MmVudihyZWFkUkRTKCJUb29scy9Nb2RlbF90b29sX3ZhcnMucmRzIiksIC5HbG9iYWxFbnYpCgojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIyMgQi0gUmVjZWl2ZSBpbmZvcm1hdGlvbiBmcm9tIERpbmFtaWNhCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgojdmFsdWVzIGZvciB0ZXN0aW5nIHB1cnBvc2VzCiMgU2ltdWxhdGVkX2x1bGNfeWVhciA8LSAiMjAyNSIKIyBTaW11bGF0aW9uX251bSA8LSAiMSIKIyBGaWxlX3BhdGhfc2ltdWxhdGVkX0xVTENfbWFwcyA8LSAiUmVzdWx0cy9EaW5hbWljYV9zaW11bGF0ZWRfTFVMQy9CQVUvdjEvc2ltdWxhdGVkX0xVTENfc2NlbmFyaW9fQkFVX3NpbUlEX3YxX3llYXJfMjAyNS50aWYiCgojUmVjZWl2ZSBjdXJyZW50IHNpbXVsYXRpb24gdGltZQpTaW11bGF0ZWRfbHVsY195ZWFyIDwtIHMzCgojc2ltdWxhdGlvbiBudW1iZXIgYmVpbmcgcGVyZm9ybWVkClNpbXVsYXRpb25fbnVtIDwtIHYyCgojbG9hZCB0YWJsZSBvZiBzaW11bGF0aW9ucwpDb250cm9sX3RhYmxlX3BhdGggPC0gczQKU2ltdWxhdGlvbl90YWJsZSA8LSByZWFkLmNzdihDb250cm9sX3RhYmxlX3BhdGgpW1NpbXVsYXRpb25fbnVtLF0KCiNWZWN0b3IgbmFtZSBvZiBTY2VuYXJpbyB0byBiZSB0ZXN0ZWQgYXMgc3RyaW5nIG9yIG51bWVyaWMgKGkuZS4gIkJBVSIgZXRjLikgClNjZW5hcmlvX0lEIDwtIFNpbXVsYXRpb25fdGFibGUkU2NlbmFyaW9fSUQuc3RyaW5nCgojVmVjdG9yIElEIGZvciB0aGlzIHJ1biBvZiB0aGUgc2NlbmFyaW8gKGUuZyBWMSkKU2ltdWxhdGlvbl9JRCA8LSBTaW11bGF0aW9uX3RhYmxlJFNpbXVsYXRpb25fSUQuc3RyaW5nCgojRGVmaW5lIG1vZGVsX21vZGU6IENhbGlicmF0aW9uIG9yIFNpbXVsYXRpb24KTW9kZWxfbW9kZSA8LSBTaW11bGF0aW9uX3RhYmxlJE1vZGVsX21vZGUuc3RyaW5nCgojUmVjZWl2ZSBmaWxlIHBhdGggZm9yIGxvYWRpbmcgc2ltdWxhdGVkIExVTEMgbWFwcwpGaWxlX3BhdGhfc2ltdWxhdGVkX0xVTENfbWFwcyA8LSBzMQoKI3RlbXAgcGF0aCBmb3IgdGVzdGluZwojVXBkYXRlZF9MVUxDX3BhdGggPC0gc3RyX3JlcGxhY2UoRmlsZV9wYXRoX3NpbXVsYXRlZF9MVUxDX21hcHMsICIudGlmIiwgIl9EVHVwZGF0ZS50aWYiKQoKI2lmIHRoZSBtb2RlbCBpcyBpbiBzaW11bGF0aW9uIG1vZGUgYW5kIHRoZSB2YWx1ZSBpbiB0aGUgZGV0ZXJtaW5pc3RpYyAKI3RyYW5zaXRpb25zIGNvbHVtbiBvZiB0aGUgY29udHJvbCB0YWJsZSBpcyBub3QgIk4iIHRoZW4gdXBkYXRlIHRoZSBjdXJyZW50IAojc2ltdWxhdGVkIExVTEMgbWFwIHdpdGggdGhlIGRldGVybWluaXN0aWMgdHJhbnNpdGlvbnMKaWYoZ3JlcGwoInNpbXVsYXRpb24iLCBNb2RlbF9tb2RlLCBpZ25vcmUuY2FzZSA9IFRSVUUpICYKICAgIGdyZXBsKCJZIiwgU2ltdWxhdGlvbl90YWJsZSREZXRlcm1pbmlzdGljX3RyYW5zLnN0cmluZywgaWdub3JlLmNhc2UgPSBUUlVFKSl7CiAgCiAgICAjTG9hZCBzaW11bGF0ZWQgTFVMQyBtYXAgZm9yIHRpbWUgc3RlcAogICAgQ3VycmVudF9sdWxjIDwtIHJhc3RlcihGaWxlX3BhdGhfc2ltdWxhdGVkX0xVTENfbWFwcykKICAgIAogICAgI2NvbnZlcnQgcmFzdGVyIHRvIGRhdGFmcmFtZQogICAgTFVMQ19kYXQgPC0gcmFzdGVyOjphcy5kYXRhLmZyYW1lKEN1cnJlbnRfbHVsYykKICAgIAogICAgI2dldCBuYW1lIG9mIGZpcnN0IGNvbHVtbgogICAgVmFsdWVfY29sIDwtIGNvbG5hbWVzKExVTENfZGF0KVsxXQoKICAgICNhZGQgSUQgY29sdW1uIHRvIGRhdGFzZXQKICAgIExVTENfZGF0JElEIDwtIHNlcS5pbnQobnJvdyhMVUxDX2RhdCkpCgogICAgI0dldCBYWSBjb29yZGluYXRlcyBvZiBjZWxscwogICAgeHlfY29vcmRpbmF0ZXMgPC0gY29vcmRpbmF0ZXMoQ3VycmVudF9sdWxjKSAKCiAgICAjY2JpbmQgWFkgY29vcmRpbmF0ZXMgdG8gZGF0YWZyYW1lIGFuZCBzZXBlcmF0ZSByb3dzIHdoZXJlIGFsbCB2YWx1ZXMgPSBOQQogICAgTFVMQ19kYXQgPC0gY2JpbmQoTFVMQ19kYXQsIHh5X2Nvb3JkaW5hdGVzKQogIAogICAgI2xvYWQgc2NlbmFyaW8gc3BlY2lmaWMgZ2xhY2llciBpbmRleAogICAgR2xhY2llcl9pbmRleCA8LSByZWFkUkRTKGZpbGUgPSBsaXN0LmZpbGVzKCJEYXRhL0dsYWNpYWxfY2hhbmdlL1NjZW5hcmlvX2luZGljZXMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbC5uYW1lcyA9IFRSVUUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuID0gU2NlbmFyaW9fSUQpKVssYygiSURfbG9jIiwgcGFzdGUoU2ltdWxhdGVkX2x1bGNfeWVhcikpXQoKICAgICNzZXBlcmF0ZSB2ZWN0b3Igb2YgY2VsbCBJRHMgZm9yIGdsYWNpZXIgYW5kIG5vbi1nbGFjZXIgY2VsbHMKICAgIE5vbl9nbGFjaWVyX0lEcyA8LSBHbGFjaWVyX2luZGV4W0dsYWNpZXJfaW5kZXhbW3Bhc3RlKFNpbXVsYXRlZF9sdWxjX3llYXIpXV09PTAsICJJRF9sb2MiXQogICAgR2xhY2llcl9JRHMgPC0gR2xhY2llcl9pbmRleFtHbGFjaWVyX2luZGV4W1twYXN0ZShTaW11bGF0ZWRfbHVsY195ZWFyKV1dPT0xLCAiSURfbG9jIl0gCiAgICAKICAgICNyZXBsYWNlIHRoZSAxJ3MgYW5kIDAncyB3aXRoIHRoZSBjb3JyZWN0IExVTEMgCiAgICBMVUxDX2RhdFtMVUxDX2RhdCRJRCAlaW4lIE5vbl9nbGFjaWVyX0lEcywgVmFsdWVfY29sXSA8LSAxMQogICAgTFVMQ19kYXRbTFVMQ19kYXQkSUQgJWluJSBHbGFjaWVyX0lEcywgVmFsdWVfY29sXSA8LSAxOQogICAgICAKICAgICNjb252ZXJ0IGJhY2sgdG8gcmFzdGVyCiAgICBVcGRhdGVkX3Jhc3RlciA8LSByYXN0ZXJGcm9tWFlaKExVTENfZGF0WyxjKCJ4IiwgInkiLCBWYWx1ZV9jb2wpXSkgCiAgCiAgICAjc2F2ZSB1cGRhdGVkIExVTEMgcmFzdGVyCiAgICB3cml0ZVJhc3RlcihVcGRhdGVkX3Jhc3RlciwgRmlsZV9wYXRoX3NpbXVsYXRlZF9MVUxDX21hcHMsIG92ZXJ3cml0ZSA9IFRSVUUsIGRhdGF0eXBlID0iSU5UMVUiKQogIH0KCiNzZW5kIGZpbGUgcGF0aCB0byBkaW5hbWljYQpvdXRwdXRTdHJpbmcoInVwZGF0ZWRfbHVsY19tYXBfcGF0aCIsIEZpbGVfcGF0aF9zaW11bGF0ZWRfTFVMQ19tYXBzKQ==" .no {{
                            @alias = Simulated LULC save path
                            NumberString simulatedLulcSavePath 1;

                            @alias = Working directory
                            NumberString specifyWorkingDirectoryFromR 2;

                            @alias = Simulated LULC year
                            NumberString simulatedLulcYear 3;

                            @alias = File path for control table
                            NumberString specifyControlTableFilePathTableConsistingOfColumnsSpecifyingTheSimulationsToBePerformedEGScenariosLengthVersionsEtc 4;

                            @alias = Simulation number
                            NumberValue simulationNumber 2;
                        }};

                        updatedLulcMapPath := ExtractStructString deterministicTransitions $"(updated_lulc_map_path)";

                        //
                        // ===
                        // Load simulated LULC map that has had deterministic transition incorporated 
                        loadUpdatedLulcMap := LoadCategoricalMap {
                            filename = updatedLulcMapPath,
                            nullValue = .none,
                            storageMode = .default,
                            suffixDigits = 0,
                            step = step0,
                            workdir = workdir
                        };
                    }};
                }};

                //
                // ===
                // If simulating during calibration period validate outputs 
                @collapsed = no
                @alias = Calibration period validation
                _ := Group scenarioTimeStepIteration {{
                    @collapsed = no
                    calculateRexpression2508 := CalculateRExpression "IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMgRGluYW1pY2FfdXNlX3ZhbGlkYXRpb246IERldHJtaW5lIGNvbmRpdGlvbiBmb3IgJ2lmIGVsc2UnIGZ1bmN0aW9uIHRvIHBlcmZvcm0KIyMgdmFsaWRhdGlvbiBvbiBzaW11bGF0aW9uIHJlc3VsdHMgIAojIyBEYXRlOiAwMS0xMC0yMDIyCiMjIEF1dGhvcjogQmVuIEJsYWNrCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIyMgQS0gUmVjZWl2ZSBpbmZvIGZyb20gRGluYW1pY2EKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiNyZWNlaXZlIHdvcmtpbmcgZGlyZWN0b3J5CndwYXRoIDwtIHM0CnNldHdkKHdwYXRoKQoKI3JlY2VpdmUgdGFibGUgb2Ygc2ltdWxhdGlvbiB0aW1lIHN0ZXBzClNpbXVsYXRpb25fdGltZV9zdGVwcyA8LSB0MQojU2ltdWx0YXRpb25fdGltZV9zdGVwcyA8LSBhcy5kYXRhLmZyYW1lKG1vZGVsX3RpbWVfc3RlcHMpCgojcmVjZWl2ZSBmaWxlIHBhdGggb2Ygc2ltdWxhdGVkIExVTEMgbWFwcyBmb3IgdGhpcyBzaW11bGF0aW9uClNpbV9MVUxDX3BhdGhfZ2VuIDwtIHMxCgojcmVjZWl2ZSBzdHJpbmcgb2YgTW9kZWwgbW9kZQpNb2RlbF9tb2RlIDwtIHMyCiNNb2RlbF9tb2RlIDwtICJjYWxpYnJhdGlvbiIKCiNyZWNlaXZlIHNpbXVsYXRpb24gSUQKU2ltX0lEIDwtIHMzCgojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIyMgQi0gRGV0ZXJtaW5lIGlmIHZhbGlkYXRpb24gaXMgcmVxdWlyZWQKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiNJZiBtb2RlbCBtb2RlIGlzIHNpbXVsYXRpb24gdGhlbiByZXR1cm4gJzAnIGFzIHZhbGlkYXRpb24gaXMgbm90IHJlcXVpcmVkCiNlbHNlIGlmIGNhbGlicmF0aW9uICx0aGVuIHZhbGlkYXRpb24gaXMgcmVxdWlyZWQgc28gcmV0dXJuICcxJyAKI2FuZCBnZW5lcmF0ZSBmaWxlIHBhdGhzIGZvciBzYXZpbmcgdmFsaWRhdGlvbiByZXN1bHRzCgojdmVjdG9yIGZvbGRlciBwYXRoIGZvciB2YWxpZGF0aW9uIHJlc3VsdHMKVmFsX3Jlc19mb2xkZXIgPC0gcGFzdGUwKHdwYXRoLCAiL1Jlc3VsdHMvVmFsaWRhdGlvbi8iLCBTaW1fSUQpClZhbF9yZXNfcGF0aCA8LSBwYXN0ZTAoVmFsX3Jlc19mb2xkZXIsICIvIiwgcGFzdGUoIlNpbXVsYXRpb24iLCBTaW1fSUQsICJmcm9tIiwgU2ltdWxhdGlvbl90aW1lX3N0ZXBzWzEsICJLZXlzIl0sICJ0byIsIFNpbXVsYXRpb25fdGltZV9zdGVwc1tucm93KFNpbXVsYXRpb25fdGltZV9zdGVwcyksICJWYWx1ZXMiXSwgc2VwID0gIl8iKSkKCmlmKGdyZXBsKCJzaW11bGF0aW9uIiwgTW9kZWxfbW9kZSwgaWdub3JlLmNhc2UgPSBUUlVFKSl7CnZhbGlkYXRpb25fY29uZGl0aW9uIDwtIDAKVmFsaWRhdGlvbl9tYXBfcGF0aCA8LSAiTkEiClZhbGlkYXRpb25fcmVzdWx0X3BhdGggPC0gIk5BIgp9IGVsc2UgIHsKdmFsaWRhdGlvbl9jb25kaXRpb24gPC0gMQoKI3ZlY3RvciBmaWxlIHBhdGhzIGZvciByZXN1bHRzCmRpci5jcmVhdGUoVmFsX3Jlc19mb2xkZXIsIHJlY3Vyc2l2ZSA9IFRSVUUpCgojYWRqdXN0IHRvIGZpbGUgcGF0aApWYWxpZGF0aW9uX21hcF9wYXRoIDwtIHBhc3RlMChWYWxfcmVzX3BhdGgsICJfbWFwLnRpZiIpClZhbGlkYXRpb25fcmVzdWx0X3BhdGggPC0gcGFzdGUwKFZhbF9yZXNfcGF0aCwgIl9zaW1pbGFyaXR5X3ZhbHVlLmNzdiIpIAp9IAoKI291dHB1dCB2YWxpZGF0aW9uIGNvbmRpdGlvbgpvdXRwdXREb3VibGUoIlVzZV92YWxpZGF0aW9uIiwgdmFsaWRhdGlvbl9jb25kaXRpb24pIAoKI091dHB1dCByZXN1bHQgcGF0aHMKb3V0cHV0U3RyaW5nKCJWYWxfbWFwX3BhdGgiLCBWYWxpZGF0aW9uX21hcF9wYXRoKQpvdXRwdXRTdHJpbmcoIlZhbF9yZXN1bHRfcGF0aCIsIFZhbGlkYXRpb25fcmVzdWx0X3BhdGgpCgojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIyMgQy0gT2JzZXJ2ZWQgTFVMQwojIyMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKI2dhdGhlciBmaWxlIHBhdGggZm9yIG9ic2VydmVkIExVTEMgeWVhciB0aGF0IGlzIGNsb3Nlc3QgdG8gdGhhdCBvZiB0aGUgZmluYWwgc2ltdWxhdGlvbiB5ZWFyCk9ic19MVUxDX3BhdGhzIDwtIGxpc3QuZmlsZXMoIkRhdGEvSGlzdG9yaWNfTFVMQyIsIGZ1bGwubmFtZXMgPSBUUlVFLCBwYXR0ZXJuID0gIi5ncmQiKQoKI2V4dHJhY3QgbnVtZXJpY3MKT2JzX0xVTENfeWVhcnMgPC0gYXMubnVtZXJpYyhnc3ViKCIuKj8oWzAtOV0rKS4qIiwgIlxcMSIsIE9ic19MVUxDX3BhdGhzKSkKCiNpZGVudGlmeSBjbG9zZXN0IExVTEMgeWVhcgpkZXNpcmVkX2x1bGNfeWVhciA8LSB3aGljaC5taW4oYWJzKE9ic19MVUxDX3llYXJzIC0gU2ltdWxhdGlvbl90aW1lX3N0ZXBzW25yb3coU2ltdWxhdGlvbl90aW1lX3N0ZXBzKSwgIktleXMiXSkpCgojc3Vic2V0IHRvIGNvcnJlY3QgTFVMQyBwYXRoCkZpbmFsX0xVTENfcGF0aCA8LSBPYnNfTFVMQ19wYXRoc1tkZXNpcmVkX2x1bGNfeWVhcl0KCiNvdXRwdXQgZmlsZSBwYXRoIGZvciBvYnNlcnZlZCBtYXAgZm9yIGZpbmFsIExVTEMgeWVhciAKb3V0cHV0U3RyaW5nKCJPYnNfTFVMQ19wYXRoIiwgRmluYWxfTFVMQ19wYXRoKQoKIyMjID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyMjIEQtIFNpbXVsYXRlZCBMVUxDCiMjIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgojYWx0ZXIgZmlsZSBwYXRoIGZvciBzaW11bGF0ZWQgTFVMQyBtYXAgZm9yIGZpbmFsIHNpbXVsYXRpb24geWVhcgpTaW1fZmluYWxfTFVMQ19wYXRoIDwtIHBhc3RlMChTaW1fTFVMQ19wYXRoX2dlbiwgU2ltdWxhdGlvbl90aW1lX3N0ZXBzW25yb3coU2ltdWxhdGlvbl90aW1lX3N0ZXBzKSwgIlZhbHVlcyJdLCAiLnRpZiIpCgojb3V0cHV0IGZpbGUgcGF0aCBmb3Igc2ltdWxhdGVkIG1hcCBmb3IgZmluYWwgTFVMQyB5ZWFyCm91dHB1dFN0cmluZygiU2ltX0xVTENfcGF0aCIsIFNpbV9maW5hbF9MVUxDX3BhdGgpCgo=" .no {{
                        @alias = Send file path for simulated LULC map
                        NumberString receiveFilePathForSimulatedLulcMaps 1;

                        @alias = Send model mode
                        NumberString receiveModelMode 2;

                        @alias = Send simulation ID
                        NumberString receiveSimulationId 3;

                        @alias = working directory
                        NumberString specifyWorkingDirectoryFromR 4;

                        @alias = Send table of simulation time steps
                        NumberTable receiveTableOfTimeStepsDefiningLengthOfSimulation 1;
                    }};

                    receiveValidationMapSavePath := ExtractStructString calculateRexpression2508 $"(Val_map_path)";

                    @viewer.string = yes
                    receiveFilePathOfObservedLulcMapForLastYearOfSimulation := ExtractStructString calculateRexpression2508 $"(Obs_LULC_path)";

                    // returning 0 does not initiate validation, returning 1 does 
                    @viewer.number = yes
                    ifThenCondition := ExtractStructNumber calculateRexpression2508 $"(Use_validation)";

                    receiveFilePathOfSimulatedLulcMap := ExtractStructString calculateRexpression2508 $"(Sim_LULC_path)";

                    receiveValidationResultSavePath := ExtractStructString calculateRexpression2508 $"(Val_result_path)";

                    _ := IfThen ifThenCondition .none {{
                        loadSimulatedLulcMap := LoadCategoricalMap {
                            filename = receiveFilePathOfSimulatedLulcMap,
                            nullValue = .none,
                            storageMode = .default,
                            suffixDigits = 0,
                            step = step,
                            workdir = workdir
                        };

                        loadObservedLulcMapForFinalYearOfSimulation := LoadCategoricalMap {
                            filename = receiveFilePathOfObservedLulcMapForLastYearOfSimulation,
                            nullValue = .none,
                            storageMode = .default,
                            suffixDigits = 0,
                            step = step,
                            workdir = workdir
                        };

                        @alias = Load Initial Lulc Map
                        loadInitialLulcMap0 := LoadCategoricalMap {
                            filename = receiveInitialLulcFilePath,
                            nullValue = .none,
                            storageMode = .default,
                            suffixDigits = 0,
                            step = step,
                            workdir = workdir
                        };

                        @viewer.similarity = yes
                        @viewer.similarityMap = yes
                        similarityMap similarity := CalcSimilarityOfDifferences {
                            initialMap = loadInitialLulcMap0,
                            observedMap = loadObservedLulcMapForFinalYearOfSimulation,
                            simulatedMap = loadSimulatedLulcMap,
                            useExponentialDecay = .yes,
                            windowSize = 11,
                            printSimilarities = .yes,
                            exponentialDecayDivisor = 2
                        };

                        SaveTextFile {
                            text = similarity,
                            filename = receiveValidationResultSavePath,
                            suffixDigits = 2,
                            step = step,
                            workdir = workdir
                        };

                        SaveMap {
                            map = similarityMap,
                            filename = receiveValidationMapSavePath,
                            suffixDigits = 2,
                            step = step,
                            useCompression = .yes,
                            workdir = workdir,
                            ignoreCostlySparseCategories = .yes
                        };
                    }};
                }};
            }};

            @alias = Update control table to reflect simulation complete
            _ := Group .none {{
                @collapsed = no
                _ := CalculateRExpression "IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMgRGluYW1pY2FfdXBkYXRlX2NvbnRyb2xfdGFibGU6IFVwZGF0ZSB0aGUgY29udHJvbCB0YWJsZSBhZnRlciBjb21wbGV0aW9uIG9mIHNpbXVsYXRpb24gCiMjIERhdGU6IDAxLTEwLTIwMjIKIyMgQXV0aG9yOiBCZW4gQmxhY2sKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmxpYnJhcnkocmVhZHIpCgojcmVjZWl2ZSBmaWxlIHBhdGggZm9yIGNvbnRyb2wgdGFibGUgCkNvbnRyb2xfdGFibGVfcGF0aCA8LSBzMQoKI3JlY2VpdmUgQm9vbGVhbiB2YWx1ZSBvZiB3aGV0aGVyIHNpbXVsYXRpb24gd2FzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkKU3VjY2VzcyA8LSBzMgpjYXQoU3VjY2VzcykKCiNyZWNlaXZlIHJvdyBudW1iZXIgb2YgY3VycmVudCBzaW11bGF0aW9uClNpbXVsYXRpb25fbnVtIDwtIHYxCiNTaW11bGF0aW9uX251bSA8LSAxCgojbG9hZCBjb250cm9sIGFuZCBzdWJzZXQgdG8gc2ltdWxhdGlvbiBudW1iZXIKQ29udHJvbF90YWJsZSA8LSByZWFkLmNzdihDb250cm9sX3RhYmxlX3BhdGgpCgojdXBkYXRlIHZhbHVlIGluIGNvbXBsZXRlZCBjb2x1bW4gZm9yIGN1cnJlbnQgc2ltdWxhdGlvbgppZihncmVwbCgiVFJVRSIsIFN1Y2Nlc3MsIGlnbm9yZS5jYXNlID0gVFJVRSkpewpDb250cm9sX3RhYmxlW0NvbnRyb2xfdGFibGUkU2ltdWxhdGlvbl9udW0uID09IFNpbXVsYXRpb25fbnVtLCJDb21wbGV0ZWQuc3RyaW5nIl0gPC0gIlkiCmNhdCgiU2ltdWxhdGlvbiB3YXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseSIpCn1lbHNlewpDb250cm9sX3RhYmxlW0NvbnRyb2xfdGFibGUkU2ltdWxhdGlvbl9udW0uID09IFNpbXVsYXRpb25fbnVtLCJDb21wbGV0ZWQuc3RyaW5nIl0gPC0gIkVSUk9SIgkKY2F0KCJTaW11bGF0aW9uIGVuY291bnRlcmVkIGFuIGVycm9yIikKCX0KCiNzYXZlIHRhYmxlCnJlYWRyOjp3cml0ZV9jc3YoQ29udHJvbF90YWJsZSwgQ29udHJvbF90YWJsZV9wYXRoKQo=" .no {{
                    @alias = File path for control table
                    NumberString specifyControlTableFilePathTableConsistingOfColumnsSpecifyingTheSimulationsToBePerformedEGScenariosLengthVersionsEtc 1;

                    @alias = Completion boolean
                    NumberString skipOnError1399 2;

                    @alias = Simulation number
                    NumberValue simulationNumber 1;
                }};
            }};
        }};
    }};
}};